<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Configuration | Server Torii</title><meta name="description" content="High-performance distributed lightweight DDoS mitigation software">
    <link rel="stylesheet" href="/server_torii-docs/assets/css/styles.d7ec87d7.css">
    <link rel="preload" href="/server_torii-docs/assets/js/runtime~app.80f5bd91.js" as="script"><link rel="preload" href="/server_torii-docs/assets/css/styles.d7ec87d7.css" as="style"><link rel="preload" href="/server_torii-docs/assets/js/768.3be347d2.js" as="script"><link rel="preload" href="/server_torii-docs/assets/js/app.cc81805f.js" as="script">
    <link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_configuration.html.c4b09db3.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_configuration.html.f562b2da.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_install.html.343a0a32.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_install.html.d19378f6.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_faq.html.ecc6c452.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_faq.html.6b041127.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_home.html.61656587.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_home.html.803e00d4.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/index.html.87e89386.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_index.html.61d6e494.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/development_roadmap.html.97189b48.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_development_roadmap.html.013d29e3.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/404.html.8273ab5e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/server_torii-docs/"><img class="vp-site-logo" src="/server_torii-docs/images/shinto_shrine.png" alt="Server Torii"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Server Torii</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/guide/home.html" aria-label="Getting started"><!--[--><!--[--><!--]--><!--]-->Getting started<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/server_torii-docs/guide/configuration.html" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/server_torii-docs/zh/guide/configuration.html" aria-label="简体中文"><!--[--><!--[--><!--]--><!--]-->简体中文<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Rayzggz/server_torii" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/guide/home.html" aria-label="Getting started"><!--[--><!--[--><!--]--><!--]-->Getting started<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/server_torii-docs/guide/configuration.html" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/server_torii-docs/zh/guide/configuration.html" aria-label="简体中文"><!--[--><!--[--><!--]--><!--]-->简体中文<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Rayzggz/server_torii" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Guide <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/home.html" aria-label="Introduction"><!--[--><!--[--><!--]--><!--]-->Introduction<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/install.html" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/server_torii-docs/guide/configuration.html" aria-label="Configuration"><!--[--><!--[--><!--]--><!--]-->Configuration<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/faq.html" aria-label="Frequently Asked Questions"><!--[--><!--[--><!--]--><!--]-->Frequently Asked Questions<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Development <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/development/roadmap.html" aria-label="Development Plan"><!--[--><!--[--><!--]--><!--]-->Development Plan<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h1><h2 id="basic-quick-setup" tabindex="-1"><a class="header-anchor" href="#basic-quick-setup"><span>Basic Quick Setup</span></a></h2><div class="hint-container tip"><p class="hint-container-title">Tip</p><p>The Basic Quick Setup focuses on the critical configuration items for running Server Torii. It’s intended to help you get started quickly with the default configuration. For detailed usage, please refer to the subsequent sections.</p></div><ol><li>Copy and create the config file</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">   <span class="token function">cp</span> <span class="token parameter variable">-r</span> server_torii/config_example server_torii/config</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>Edit config/torii.yml</li></ol><p>Focus on the following key settings:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>
<span class="line">    <span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>
<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules&quot;</span> <span class="token comment"># Directory for rule files (this example assumes /www/server_torii as the install dir)</span></span>
<span class="line">    <span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>
<span class="line">    <span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Update your Nginx configuration</li></ol><p>The ngx_torii module uses the similar directives as Nginx’s auth_request module.</p><p>In the server block or location where you want to protection, add:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span>  <span class="token comment">#Send auth check to Server Torii</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Receive auth checks from torii_auth_request</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Captcha-Status <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Handle all other Server Torii endpoints (captcha pages, health checks, etc.)</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>Reload Nginx</li></ol><h2 id="more-configuration" tabindex="-1"><a class="header-anchor" href="#more-configuration"><span>More Configuration</span></a></h2><h3 id="config-torii-yml" tabindex="-1"><a class="header-anchor" href="#config-torii-yml"><span>config/torii.yml</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>
<span class="line"><span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>
<span class="line"><span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules&quot;</span> <span class="token comment"># Directory for rule files (this example assumes /www/server_torii as the install dir)</span></span>
<span class="line"><span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>
<span class="line"><span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>
<span class="line"><span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span> <span class="token comment"># Node name used for display on the output page, can be used to distinguish nodes in a distributed deployment.</span></span>
<span class="line"><span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span> <span class="token comment"># Host header, used to determine the domain name of the request.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>
<span class="line"><span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span> <span class="token comment"># IP header, used to determine the User IP of the request.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>
<span class="line"><span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span> <span class="token comment"># URI header, used to determine the URI of the request.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>
<span class="line"><span class="token key atrule">connecting_captcha_status_headers</span><span class="token punctuation">:</span> <span class="token comment"># Turn on or Turn off the CAPTCHA</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Captcha-Status&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="captcha-yml" tabindex="-1"><a class="header-anchor" href="#captcha-yml"><span>CAPTCHA.yml</span></a></h3><h4 id="secret-key" tabindex="-1"><a class="header-anchor" href="#secret-key"><span><code>secret_key</code></span></a></h4><p>A shared key for encrypting/decrypting the clearance cookie. In clustered setups, all nodes must use the same key to validate cookies.</p><h4 id="captcha-validate-time" tabindex="-1"><a class="header-anchor" href="#captcha-validate-time"><span><code>captcha_validate_time</code></span></a></h4><p>Time (in seconds) for which a passed captcha remains valid before re‑challenge.</p><h4 id="captcha-challenge-session-timeout" tabindex="-1"><a class="header-anchor" href="#captcha-challenge-session-timeout"><span><code>captcha_challenge_session_timeout</code></span></a></h4><p>Time (in seconds) allowed to complete the captcha after the challenge page loads.</p><h4 id="hcaptcha-secret" tabindex="-1"><a class="header-anchor" href="#hcaptcha-secret"><span><code>hcaptcha_secret</code></span></a></h4><p>Your hCaptcha secret key for server‑side verification.</p><h3 id="httpflood-yml" tabindex="-1"><a class="header-anchor" href="#httpflood-yml"><span>HTTPFlood.yml</span></a></h3><p>This feature cannot be disabled in current version. To turn it off with minimize the influence, set extremely high limits and very short intervals. (like 1000000/1s )</p><h4 id="httpfloodspeedlimit" tabindex="-1"><a class="header-anchor" href="#httpfloodspeedlimit"><span><code>HTTPFloodSpeedLimit</code></span></a></h4><p><code> - &quot;150/10s&quot;</code> Allows up to 150 requests per IP every 10 seconds (429 on excess).</p><h4 id="httpfloodsameurilimit" tabindex="-1"><a class="header-anchor" href="#httpfloodsameurilimit"><span><code>HTTPFloodSameURILimit</code></span></a></h4><p><code> - &quot;50/10s&quot;</code></p><p>Allows up to 50 requests per IP to the same URI every 10 seconds (429 on excess). Helps mitigate URI‑focused floods.</p><h3 id="ip-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#ip-allowlist-conf"><span>IP_AllowList.conf</span></a></h3><p>One IP (or CIDR) per line Allowlisted addresses bypass all checks.</p><h3 id="ip-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#ip-blocklist-conf"><span>IP_BlockList.conf</span></a></h3><p>One IP (or CIDR) per line Blocklisted addresses are immediately blocked.</p><h3 id="url-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#url-allowlist-conf"><span>URL_AllowList.conf</span></a></h3><p>One URL pattern (regex) per line Allowlisted URIs are immediately blocked.</p><h3 id="url-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#url-blocklist-conf"><span>URL_BlockList.conf</span></a></h3><p>One URL pattern (regex) per line Blocklisted URIs are immediately blocked.</p><h3 id="verifybot-yml" tabindex="-1"><a class="header-anchor" href="#verifybot-yml"><span>VerifyBot.yml</span></a></h3><p>Use User‑Agent and reverse‑DNS to verify legitimate crawlers:</p><p>verify_google_bot # Googlebot</p><p>verify_bing_bot # Bingbot</p><p>verify_baidu_bot # Baidu spider</p><p>verify_yandex_bot # Yandex crawler</p><p>verify_sogou_bot # Sogou spider</p><p>verify_apple_bot # Applebot</p><h3 id="ngx-torii-module-configuration" tabindex="-1"><a class="header-anchor" href="#ngx-torii-module-configuration"><span>ngx_torii Module Configuration</span></a></h3><p>The ngx_torii module uses the similar directives as Nginx’s auth_request module.</p><p>You can reference the document of ngx_http_auth_request_module <code>https://nginx.org/en/docs/http/ngx_http_auth_request_module.html</code></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request uri | <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">Default:</span>   torii_auth_request <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">Context:   http, server, location</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request_set <span class="token variable">$variable</span> value</span><span class="token punctuation">;</span></span>
<span class="line">Default:   —</span>
<span class="line">Context:   http, server, location</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example Reverse‑Proxy with Server Torii:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment">#Reverse‑proxy your upstream service</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> </span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:3001/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host localhost</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> REMOTE-HOST <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token variable">$connection_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span>   <span class="token comment">#Route through Server Torii</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Receive the auth check</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Captcha-Status <span class="token boolean">on</span></span><span class="token punctuation">;</span> <span class="token comment">#set to off to disable captcha</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Handle Torii’s own endpoints (captcha, health, etc.)</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/Rayzggz/server_torii/edit/main/guide/configuration.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated:: </span><time class="meta-item-info" datetime="2025-05-05T01:16:34.000Z" data-allow-mismatch>5/5/25, 1:16 AM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 37480123+Rayzggz@users.noreply.github.com">Rayzggz</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/server_torii-docs/guide/install.html" aria-label="Installation"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">Installation</span></div><!--]--></a><a class="route-link auto-link next" href="/server_torii-docs/guide/faq.html" aria-label="Frequently Asked Questions"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Frequently Asked Questions</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script src="/server_torii-docs/assets/js/runtime~app.80f5bd91.js" defer></script><script src="/server_torii-docs/assets/js/768.3be347d2.js" defer></script><script src="/server_torii-docs/assets/js/app.cc81805f.js" defer></script>
  </body>
</html>

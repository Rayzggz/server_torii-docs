"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[77],{8404:(n,s,e)=>{e.r(s),e.d(s,{comp:()=>l,data:()=>t});var i=e(641);const a={},l=(0,e(6262).A)(a,[["render",function(n,s){const e=(0,i.g2)("RouteLink");return(0,i.uX)(),(0,i.CE)("div",null,[s[1]||(s[1]=(0,i.Fv)('<h1 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h1><div class="hint-container warning"><p class="hint-container-title">警告</p><p>Server Torii 目前仍在积极的添加新的功能，并且完善部分现有功能的配置。你已经可以用它来保护你的站点，但是在版本更新的时候，有可能会发生一些破坏性更新。因此，在更新的时候，请注意参考更新指南。</p></div><p>安装分为两部分 ngx_torii 和 server_torii</p><p>ngx_torii 是一个 Nginx 模块，是 server_torii 的连接器，用于将 Nginx 收到的请求发送给 server_torii 检查</p><h2 id="安装-sever-torii" tabindex="-1"><a class="header-anchor" href="#安装-sever-torii"><span>安装 Sever_torii</span></a></h2><ol><li>创建工作目录 可改为任意其他目录</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /www/server_torii</span>\n<span class="line"><span class="token builtin class-name">cd</span> /www/server_torii</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>下载 server_torii</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">git</span> clone https://github.com/Rayzggz/server_torii.git</span>\n<span class="line"><span class="token builtin class-name">cd</span> server_torii</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>参照配置指南修改配置文件</li></ol>',10)),(0,i.Lk)("p",null,[(0,i.bF)(e,{to:"/zh/guide/configuration.html"},{default:(0,i.k6)((()=>s[0]||(s[0]=[(0,i.eW)("快速开始配置")]))),_:1})]),s[2]||(s[2]=(0,i.Fv)('<ol start="4"><li>使用Makefile编译 install 目标会在当前工作目录进行编译 编译后的可执行程序将放置在当前目录下 并且将 server_torii 添加到系统服务中 最后会自动启动 server_torii 并将其添加到开机启动项中</li></ol><p>如果希望以其他方式运行 可以按照标准 go 程序的方式编译和运行</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">make</span> <span class="token function">install</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>接来在 Nginx 或 OpenResty 等 Nginx 兼容的 Web 服务上安装 ngx_torii 模块</p><h2 id="编译安装-ngx-torii" tabindex="-1"><a class="header-anchor" href="#编译安装-ngx-torii"><span>编译安装 ngx_torii</span></a></h2><div class="hint-container tip"><p class="hint-container-title">如何获取编译参数</p><p>编译安装需要知道当前的 Nginx 的编译参数，通过运行 <code>nginx -V</code> 获取 例如：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"># nginx -V</span>\n<span class="line"></span>\n<span class="line">nginx version: nginx/1.21.4</span>\n<span class="line">built by gcc 13.3.0 (Ubuntu 13.3.0-6ubuntu2~24.04) </span>\n<span class="line">built with OpenSSL 1.1.1w  11 Sep 2023</span>\n<span class="line">TLS SNI support enabled</span>\n<span class="line">configure arguments: --user=www --group=www --prefix=/www/server/nginx --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-openssl=/www/server/nginx/src/openssl --with-pcre=pcre-8.43 --with-http_v2_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-http_auth_request_module --add-module=/www/server/nginx/src/ngx_http_substitutions_filter_module-master --with-ld-opt=-Wl,-E --with-cc-opt=-Wno-error --with-ld-opt=-ljemalloc --with-http_dav_module --add-module=/www/server/nginx/src/nginx-dav-ext-module</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请使用 <code>configure arguments:</code> 后面的内容，下文中将使用 <code>ARG</code> 来代替这块内容。</p></div><p>ngx_torii 代码仓库： <code>https://github.com/Rayzggz/ngx_torii</code></p><p>此项目基于Nginx内置模块 ngx_http_auth_request_module 进行了简单修改以支持 server_torii</p><p>使用 <code>git clone https://github.com/Rayzggz/ngx_torii</code> 获取代码</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">$ <span class="token builtin class-name">cd</span> nginx-1.x.x</span>\n<span class="line">$ ./configure ARG --add-module<span class="token operator">=</span>/path/to/ngx_torii</span>\n<span class="line">$ <span class="token function">make</span></span>\n<span class="line">$ <span class="token function">make</span> <span class="token function">install</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="宝塔面板-自动安装-ngx-torii" tabindex="-1"><a class="header-anchor" href="#宝塔面板-自动安装-ngx-torii"><span>宝塔面板 自动安装 ngx_torii</span></a></h2><div class="hint-container caution"><p class="hint-container-title">警告</p><p>这个方法需要卸载当前的 Nginx 并重新安装，可能会对正在运行的服务造成影响</p><p>如希望尽量减少对服务的影响，并且当前 Nginx 在安装时选择的是编译安装，可以使用下面的“宝塔面板 替换安装 ngx_torii”指南</p></div><ol><li>在软件商店卸载Nginx</li><li>在软件商店安装Nginx 选择「编译安装」选项</li><li>「添加自定义模块」中添加 <code>ngx_torii</code> 模块</li></ol><ul><li>名称： <code>ngx_torii</code></li><li>描述： <code>Server Torii Nginx Module</code></li><li>参数： <code>--add-module=/www/server/nginx/src/ngx_torii</code></li><li>前置脚本：</li></ul><div class="hint-container caution"><p class="hint-container-title">警告</p><p>如果您的服务器位于中华人民共和国境内</p><p>您的服务器可能无法从 GitHub 上下载代码 从而导致安装失败</p><p>您可以将下面前置脚本的 <code>git clone https://github.com/Rayzggz/ngx_torii</code> 替换为GitHub镜像站点的地址</p></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /www/server/nginx/src</span>\n<span class="line"><span class="token builtin class-name">cd</span> /www/server/nginx/src</span>\n<span class="line"><span class="token function">git</span> clone https://github.com/Rayzggz/ngx_torii</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>按照宝塔的提示完成安装</li></ol><h2 id="宝塔面板-替换安装-ngx-torii" tabindex="-1"><a class="header-anchor" href="#宝塔面板-替换安装-ngx-torii"><span>宝塔面板 替换安装 ngx_torii</span></a></h2><div class="hint-container warning"><p class="hint-container-title">警告</p><p>使用这个方法需要保证您当前的 Nginx 是通过宝塔面板编译安装的 如果 <code>/www/server/nginx/src</code> 文件夹内存在源码文件，则说明当前 Nginx 是通过编译安装的</p></div><div class="hint-container tip"><p class="hint-container-title">如何获取编译参数</p><p>编译安装需要知道当前的 Nginx 的编译参数，通过运行 <code>nginx -V</code> 获取 例如：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"># nginx -V</span>\n<span class="line"></span>\n<span class="line">nginx version: nginx/1.21.4</span>\n<span class="line">built by gcc 13.3.0 (Ubuntu 13.3.0-6ubuntu2~24.04) </span>\n<span class="line">built with OpenSSL 1.1.1w  11 Sep 2023</span>\n<span class="line">TLS SNI support enabled</span>\n<span class="line">configure arguments: --user=www --group=www --prefix=/www/server/nginx --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-openssl=/www/server/nginx/src/openssl --with-pcre=pcre-8.43 --with-http_v2_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-http_auth_request_module --add-module=/www/server/nginx/src/ngx_http_substitutions_filter_module-master --with-ld-opt=-Wl,-E --with-cc-opt=-Wno-error --with-ld-opt=-ljemalloc --with-http_dav_module --add-module=/www/server/nginx/src/nginx-dav-ext-module</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请使用 <code>configure arguments:</code> 后面的内容，下文中将使用 <code>ARG</code> 来代替这块内容。</p></div><p>请逐步按照下面的指南操作</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># 1. 进入宝塔 Nginx 源码目录，下载 ngx_torii 模块代码</span></span>\n<span class="line"><span class="token comment">#    如果您的服务器位于中华人民共和国境内</span></span>\n<span class="line"><span class="token comment">#    您的服务器可能无法从 GitHub 上下载代码 从而导致安装失败</span></span>\n<span class="line"><span class="token comment">#    您可以将下面的 git clone 地址替换为GitHub镜像站点的地址</span></span>\n<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /www/server/nginx/src</span>\n<span class="line"><span class="token builtin class-name">cd</span> /www/server/nginx/src</span>\n<span class="line"><span class="token function">git</span> clone https://github.com/Rayzggz/ngx_torii</span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 2. 宝塔提供的部分 Nginx 版本需要引入 LuaJIT 环境变量</span></span>\n<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LUAJIT_LIB</span><span class="token operator">=</span>/usr/local/lib</span>\n<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LUAJIT_INC</span><span class="token operator">=</span>/usr/local/include/luajit-2.1/</span>\n<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/usr/local/lib/:<span class="token variable">$LD_LIBRARY_PATH</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 3. 配置 Nginx，添加 ngx_torii 模块</span></span>\n<span class="line"><span class="token comment"># 这里的 ARG 请替换为上文获取到的编译参数</span></span>\n<span class="line">./configure ARG --add-module<span class="token operator">=</span>/www/server/nginx/src/ngx_torii</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 4. 编译 Nginx</span></span>\n<span class="line"><span class="token function">make</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 5. 停止 Nginx 服务</span></span>\n<span class="line">/etc/init.d/nginx stop</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 6. 备份当前 Nginx 可执行文件</span></span>\n<span class="line"><span class="token function">mv</span> /www/server/nginx/sbin/nginx  /www/server/nginx/sbin/nginx.bak</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 7. 安装新编译的 Nginx 可执行文件</span></span>\n<span class="line"><span class="token function">cp</span> /www/server/nginx/src/objs/nginx /www/server/nginx/sbin/</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 8. 启动 Nginx 服务</span></span>\n<span class="line">/etc/init.d/nginx start</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 9. 验证 Nginx 是否正确加载 ngx_torii 模块</span></span>\n<span class="line">nginx <span class="token parameter variable">-V</span></span>\n<span class="line">编译参数的末尾应该包含 --add-module<span class="token operator">=</span>/www/server/nginx/src/ngx_torii</span>\n<span class="line"></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',22))])}]]),t=JSON.parse('{"path":"/zh/guide/install.html","title":"安装","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"安装 Sever_torii","slug":"安装-sever-torii","link":"#安装-sever-torii","children":[]},{"level":2,"title":"编译安装 ngx_torii","slug":"编译安装-ngx-torii","link":"#编译安装-ngx-torii","children":[]},{"level":2,"title":"宝塔面板 自动安装 ngx_torii","slug":"宝塔面板-自动安装-ngx-torii","link":"#宝塔面板-自动安装-ngx-torii","children":[]},{"level":2,"title":"宝塔面板 替换安装 ngx_torii","slug":"宝塔面板-替换安装-ngx-torii","link":"#宝塔面板-替换安装-ngx-torii","children":[]}],"git":{"updatedTime":1763588132000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":9,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"847e1732ee395dfa87596a80881d6b29d71a34c1","time":1763588132000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: update configuration and installation documentation and url"},{"hash":"e12ef74c25ece757b7b3624109f465f2e371986e","time":1762740430000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: update environment requirements and installation instructions for ngx_torii"},{"hash":"5194a59c8d91c22df9d3965d24cfa2820895261e","time":1751669773000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: improve formatting and links"},{"hash":"c048890e1f729c2bb40fb069ff30099a264028d6","time":1751498824000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: 1.1.0"},{"hash":"bac19908e6c1afc3a19dcf7db6667003606db5d2","time":1746558662000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: Add install warning"},{"hash":"1e3c9056f768a108e300d8d259bbc580c9f73193","time":1746411092000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: add link to config"},{"hash":"18f22f10d2875bd5573e982ce2de0b99c5a71d8e","time":1746406274000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: en install.md"},{"hash":"299946ad065640e8de3d4e3db60fb34b451b9e4a","time":1746329088000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: chinese"},{"hash":"c273ef4b4d575a9136c146ae46acb02d2989ca06","time":1746242211000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: Config and some install docs"}]},"filePathRelative":"zh/guide/install.md"}')}}]);
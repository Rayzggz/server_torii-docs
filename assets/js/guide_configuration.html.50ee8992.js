"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[71],{7738:(s,n,a)=>{a.r(n),a.d(n,{comp:()=>t,data:()=>p});var e=a(641);const i={},t=(0,a(6262).A)(i,[["render",function(s,n){return(0,e.uX)(),(0,e.CE)("div",null,n[0]||(n[0]=[(0,e.Fv)('<h1 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h1><h2 id="basic-quick-setup" tabindex="-1"><a class="header-anchor" href="#basic-quick-setup"><span>Basic Quick Setup</span></a></h2><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>The Basic Quick Setup focuses on the critical configuration items for running Server Torii. It’s intended to help you get started quickly with the default configuration. For detailed usage, please refer to the subsequent sections.</p></div><ol><li>Copy and create the config file</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">   <span class="token function">cp</span> <span class="token parameter variable">-r</span> server_torii/config_example server_torii/config</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>Edit config/torii.yml</li></ol><p>Focus on the following key settings:</p><p><code>port</code> Ensure it is not occupied</p><p><code>web_path</code> Ensure this path is not used by your website</p><p><code>error_page</code> Correctly set the storage path for error pages</p><p><code>log_path</code> Correctly set the storage path for logs</p><p><code>sites</code> Site configuration files The default example configuration file only contains the <code>default_site</code> site configuration and rule files under the path config/rules/default. For Basic Quick Setup, you need to delete the <code>example.com</code> and <code>*.example.com</code> site configurations.</p><p>Assuming we install server_torii in the <code>/www/server_torii</code> directory, the content of the config/torii.yml file is as follows:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>\n<span class="line">    <span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>\n<span class="line">    <span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>\n<span class="line">    <span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>\n<span class="line">    <span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_feature_control_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Feature-Control&quot;</span></span>\n<span class="line">      <span class="token punctuation">-</span> </span>\n<span class="line">    <span class="token key atrule">sites</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;default_site&quot;</span> <span class="token comment">#This is the default site configuration corresponding to requests that do not match any other sites.</span></span>\n<span class="line">        <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/default&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Update your Nginx configuration</li></ol><p>The ngx_torii module uses the similar directives as Nginx’s auth_request module.</p><p>In the server block or location where you want to protection, add:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment">#Send auth check to Server Torii</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">445</span> = @torii_page</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">torii_auth_request_set</span> <span class="token variable">$torii_action_uri</span> <span class="token variable">$upstream_http_torii_action</span></span><span class="token punctuation">;</span>  </span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Receive auth checks from torii_auth_request</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> @torii_page</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker_pages/<span class="token variable">$torii_action_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>Reload Nginx</li></ol>',19)]))}]]),p=JSON.parse('{"path":"/guide/configuration.html","title":"Configuration","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Basic Quick Setup","slug":"basic-quick-setup","link":"#basic-quick-setup","children":[]}],"git":{"updatedTime":1762929880000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":4,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"aecaee7137b3460c71600b166e4ea175b2a3cef8","time":1762929880000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: add advanced configuration documentation and update existing settings"},{"hash":"5194a59c8d91c22df9d3965d24cfa2820895261e","time":1751669773000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: improve formatting and links"},{"hash":"c048890e1f729c2bb40fb069ff30099a264028d6","time":1751498824000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: 1.1.0"},{"hash":"670a69ef292948d85a1bb8dcdaa2df27c7efef67","time":1746407794000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: en configuration.md"}]},"filePathRelative":"guide/configuration.md"}')}}]);
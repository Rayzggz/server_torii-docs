"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[933],{8259:(e,t,a)=>{a.r(t),a.d(t,{comp:()=>n,data:()=>l});var r=a(641);const i={},n=(0,a(6262).A)(i,[["render",function(e,t){return(0,r.uX)(),(0,r.CE)("div",null,t[0]||(t[0]=[(0,r.Fv)('<h1 id="external-mitigation-service-configuration" tabindex="-1"><a class="header-anchor" href="#external-mitigation-service-configuration"><span>External Mitigation Service Configuration</span></a></h1><p>This document provides detailed instructions on how to configure and integrate the external mitigation service.</p><h2 id="_1-configuration-parameters" tabindex="-1"><a class="header-anchor" href="#_1-configuration-parameters"><span>1. Configuration Parameters</span></a></h2><p>The following parameters are required in <code>Server.yml</code> to enable and configure this feature.</p><table><thead><tr><th style="text-align:left;">Parameter</th><th style="text-align:left;">Type</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>enabled</code></td><td style="text-align:left;">Boolean</td><td style="text-align:left;"><code>true</code> or <code>false</code>. Enables or disables this feature.</td></tr><tr><td style="text-align:left;"><code>redirect_url</code></td><td style="text-align:left;">String</td><td style="text-align:left;">Specifies the URL of the external verification service to which users will be redirected.</td></tr><tr><td style="text-align:left;"><code>secret_key</code></td><td style="text-align:left;">String</td><td style="text-align:left;">The secret key used to generate and verify HMAC signatures. Ensure this key is sufficiently complex and secure.</td></tr><tr><td style="text-align:left;"><code>session_timeout</code></td><td style="text-align:left;">Integer</td><td style="text-align:left;">Specifies the session timeout duration in seconds. After this period, the user must be re-validated by the external verification service.</td></tr></tbody></table><h2 id="_2-redirecting-to-the-external-service" tabindex="-1"><a class="header-anchor" href="#_2-redirecting-to-the-external-service"><span>2. Redirecting to the External Service</span></a></h2><p>When Server Torii redirects a user to the external service, the URL will include the following query parameters. You must store these parameters to correctly redirect the user back after they are successfully verified by the external service.</p><h3 id="query-parameters" tabindex="-1"><a class="header-anchor" href="#query-parameters"><span>Query Parameters</span></a></h3><table><thead><tr><th style="text-align:left;">Parameter</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>domain</code></td><td style="text-align:left;">The domain of the original request.</td></tr><tr><td style="text-align:left;"><code>session_id</code></td><td style="text-align:left;">The session ID generated by Server Torii.</td></tr><tr><td style="text-align:left;"><code>original_uri</code></td><td style="text-align:left;">The URI the user originally attempted to access.</td></tr><tr><td style="text-align:left;"><code>hmac</code></td><td style="text-align:left;">The HMAC signature used to verify the authenticity of the request.</td></tr></tbody></table><h3 id="redirect-url-example" tabindex="-1"><a class="header-anchor" href="#redirect-url-example"><span>Redirect URL Example</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">https://example.com/your-verification-page?domain=your-website.com&amp;session_id=somesessionid&amp;original_uri=%2Fprotected%2Fresource&amp;hmac=abc123xyz456</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="hmac-signature-calculation" tabindex="-1"><a class="header-anchor" href="#hmac-signature-calculation"><span>HMAC Signature Calculation</span></a></h3><p>The HMAC signature is used to ensure the integrity and security of the request. It must be strictly validated on the external verification service&#39;s side to prevent security vulnerabilities, such as arbitrary redirects.</p><p><strong>Calculation Method:</strong> Create an HMAC object (using the SHA512 algorithm) with the <code>secret_key</code>. Then, generate the signature by creating a string that concatenates <code>domain</code>, <code>timestampStr</code>, and <code>original_uri</code>, separated by colons (<code>:</code>).</p><p><strong>Example:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">hmac = HMAC-SHA512(secretKey, domain + &quot;:&quot; + timestampStr + &quot;:&quot; + originalUri)</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-redirecting-the-user-back-to-server-torii" tabindex="-1"><a class="header-anchor" href="#_3-redirecting-the-user-back-to-server-torii"><span>3. Redirecting the User Back to Server Torii</span></a></h2><p>After your external service has successfully verified the user, you must redirect the user back to Server Torii&#39;s fixed callback endpoint: <code>/torii/external_migration</code>.</p><h3 id="callback-parameters" tabindex="-1"><a class="header-anchor" href="#callback-parameters"><span>Callback Parameters</span></a></h3><p>When performing the callback, you must provide the following parameters in the URL query:</p><table><thead><tr><th style="text-align:left;">Parameter</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>original_uri</code></td><td style="text-align:left;">The original URI that the user initially requested.</td></tr><tr><td style="text-align:left;"><code>timestamp</code></td><td style="text-align:left;">The current timestamp.</td></tr><tr><td style="text-align:left;"><code>hmac</code></td><td style="text-align:left;">A new HMAC signature generated based on the callback parameters.</td></tr></tbody></table><h3 id="hmac-signature-calculation-callback" tabindex="-1"><a class="header-anchor" href="#hmac-signature-calculation-callback"><span>HMAC Signature Calculation (Callback)</span></a></h3><p><strong>Calculation Method:</strong> Create an HMAC object (using the SHA512 algorithm) with the <code>secret_key</code>. Then, generate the signature by creating a string that directly concatenates <code>sessionID</code>, <code>timestamp</code>, and <code>original_uri</code>.</p><p><strong>Example:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">hmac = HMAC-SHA512(secretKey, sessionID + timestamp + original_uri)</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>To ensure security and proper functionality, you must redirect the user back to the Server Torii callback endpoint immediately after calculating the HMAC.</p></div>',26)]))}]]),l=JSON.parse('{"path":"/advanced/external_migration.html","title":"External Mitigation Service Configuration","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"1. Configuration Parameters","slug":"_1-configuration-parameters","link":"#_1-configuration-parameters","children":[]},{"level":2,"title":"2. Redirecting to the External Service","slug":"_2-redirecting-to-the-external-service","link":"#_2-redirecting-to-the-external-service","children":[{"level":3,"title":"Query Parameters","slug":"query-parameters","link":"#query-parameters","children":[]},{"level":3,"title":"Redirect URL Example","slug":"redirect-url-example","link":"#redirect-url-example","children":[]},{"level":3,"title":"HMAC Signature Calculation","slug":"hmac-signature-calculation","link":"#hmac-signature-calculation","children":[]}]},{"level":2,"title":"3. Redirecting the User Back to Server Torii","slug":"_3-redirecting-the-user-back-to-server-torii","link":"#_3-redirecting-the-user-back-to-server-torii","children":[{"level":3,"title":"Callback Parameters","slug":"callback-parameters","link":"#callback-parameters","children":[]},{"level":3,"title":"HMAC Signature Calculation (Callback)","slug":"hmac-signature-calculation-callback","link":"#hmac-signature-calculation-callback","children":[]}]}],"git":{"updatedTime":1751666849000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":2,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"82d290b13e84757735ceffa7ae17e6040ceb13e1","time":1751666849000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: external migration configuration documentation"},{"hash":"c048890e1f729c2bb40fb069ff30099a264028d6","time":1751498824000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: 1.1.0"}]},"filePathRelative":"advanced/external_migration.md"}')}}]);
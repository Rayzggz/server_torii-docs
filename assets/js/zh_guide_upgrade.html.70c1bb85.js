"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[530],{593:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>t,data:()=>p});var e=a(641);const l={},t=(0,a(6262).A)(l,[["render",function(n,s){const a=(0,e.g2)("RouteLink");return(0,e.uX)(),(0,e.CE)("div",null,[s[3]||(s[3]=(0,e.Fv)('<h1 id="升级指南" tabindex="-1"><a class="header-anchor" href="#升级指南"><span>升级指南</span></a></h1><p>Server Torii 目前仍在积极的添加新的功能，并且完善部分现有功能的配置。你已经可以用它来保护你的站点，但是在版本更新的时候，有可能会发生一些破坏性更新。</p><p>因此，在更新的时候，请参照此升级指南 ，下列版本号均为破坏性更新版本号。</p><p>如果跳过了某个版本号，即此版本没有破坏性更新或功能更新。</p><p>如果需要跨版本更新，请逐步参照所有中间版本的升级指南。</p><p>同时此升级指南将会记录每个版本的功能性更新，帮助对新功能进行快速配置</p><h2 id="升级到-1-3-0" tabindex="-1"><a class="header-anchor" href="#升级到-1-3-0"><span>升级到 1.3.0</span></a></h2><h3 id="破坏更新" tabindex="-1"><a class="header-anchor" href="#破坏更新"><span>破坏更新</span></a></h3><h4 id="修改配置文件结构" tabindex="-1"><a class="header-anchor" href="#修改配置文件结构"><span>修改配置文件结构</span></a></h4><p><code>Server.yml</code> 已更新</p><p>假设我们将 server_torii 放在 <code>/www/server_torii</code> 目录下 config/torii.yml 文件内容如下：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii 监听端口  此端口不需要公开 仅供 Nginx 访问</span></span>\n<span class="line">    <span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Server Torii 访问路径</span></span>\n<span class="line">    <span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># 错误页面存放路径 </span></span>\n<span class="line">    <span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># 日志存放路径</span></span>\n<span class="line">    <span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_feature_control_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Feature-Control&quot;</span></span>\n<span class="line"></span>\n<span class="line">    <span class="token key atrule">sites</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;default_site&quot;</span> <span class="token comment">#这个是默认站点配置 对应没有匹配到其他站点的请求</span></span>\n<span class="line">        <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/default&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前版本的 <code>config/rules/</code> 中的其他配置文件已移动到站点规则目录下 按照匹配规则 放在 <code>config/rules/default/</code> 目录 或者 其他站点规则目录下 需要与 <code>torii.yml</code> 中的 <code>rule_path</code> 配置一致</p><h4 id="修改-nginx-配置文件" tabindex="-1"><a class="header-anchor" href="#修改-nginx-配置文件"><span>修改 Nginx 配置文件</span></a></h4><p><code>ngx_torii</code> 模块已更新 需要拉取最新仓库重新编译 Nginx</p><p>同样的，Nginx 配置文件也需要更新，请参考配置指南</p><h2 id="升级到-1-2-0" tabindex="-1"><a class="header-anchor" href="#升级到-1-2-0"><span>升级到 1.2.0</span></a></h2><p>此版本已撤销， 请直接升级到 1.3.0</p><h2 id="升级到-1-1-0" tabindex="-1"><a class="header-anchor" href="#升级到-1-1-0"><span>升级到 1.1.0</span></a></h2><h3 id="破坏更新-1" tabindex="-1"><a class="header-anchor" href="#破坏更新-1"><span>破坏更新</span></a></h3><h4 id="合并配置文件" tabindex="-1"><a class="header-anchor" href="#合并配置文件"><span>合并配置文件</span></a></h4><p>前版本的 <code>config/rules</code> 路径下的YAML配置文件 <code>CAPTCHA.yml</code> 、 <code>HTTPFlood.yml</code> 和 <code>VerifyBot.yml</code> 已经合并为 <code>Server.yml</code> 中的 <code>CAPTCHA</code> 、 <code>HTTPFlood</code> 和 <code>VerifyBot</code> 部分。</p><p>你可以简单的将这三个文件的内容复制到 <code>Server.yml</code> 中相应的部分。请注意YAML的缩进格式。</p><p>新配置如下</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">CAPTCHA</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>\n<span class="line">  <span class="token key atrule">captcha_validate_time</span><span class="token punctuation">:</span> <span class="token number">600</span></span>\n<span class="line">  <span class="token key atrule">captcha_challenge_session_timeout</span><span class="token punctuation">:</span> <span class="token number">120</span></span>\n<span class="line">  <span class="token key atrule">hcaptcha_secret</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span></span>\n<span class="line"><span class="token key atrule">HTTPFlood</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">HTTPFloodSpeedLimit</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;150/10s&quot;</span></span>\n<span class="line">  <span class="token key atrule">HTTPFloodSameURILimit</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;50/10s&quot;</span></span>\n<span class="line"><span class="token key atrule">VerifyBot</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">verify_google_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_bing_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_baidu_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_yandex_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_sogou_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_apple_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line"><span class="token key atrule">ExternalMigration</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>\n<span class="line">  <span class="token key atrule">redirect_url</span><span class="token punctuation">:</span> <span class="token string">&quot;https://example.com/migration&quot;</span></span>\n<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>\n<span class="line">  <span class="token key atrule">session_timeout</span><span class="token punctuation">:</span> <span class="token number">1800</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="功能更新" tabindex="-1"><a class="header-anchor" href="#功能更新"><span>功能更新</span></a></h3><h4 id="外部缓解服务" tabindex="-1"><a class="header-anchor" href="#外部缓解服务"><span>外部缓解服务</span></a></h4>',27)),(0,e.Lk)("p",null,[s[1]||(s[1]=(0,e.eW)("Server Torii 现在支持外部缓解服务。你可以配置 Server Torii 将用户重定向到外部服务进行验证。 请参照 ")),(0,e.bF)(a,{to:"/zh/advanced/external_migration.html"},{default:(0,e.k6)((()=>s[0]||(s[0]=[(0,e.eW)("外部缓解服务配置")]))),_:1}),s[2]||(s[2]=(0,e.eW)(" 进行配置。"))]),s[4]||(s[4]=(0,e.Lk)("h4",{id:"新增错误页面",tabindex:"-1"},[(0,e.Lk)("a",{class:"header-anchor",href:"#新增错误页面"},[(0,e.Lk)("span",null,"新增错误页面")])],-1)),s[5]||(s[5]=(0,e.Lk)("p",null,[(0,e.eW)("部分错误将会通过错误页面模板输出 可修改 "),(0,e.Lk)("code",null,"config/error_page/error.html"),(0,e.eW)(" 进行自定义错误页面内容")],-1))])}]]),p=JSON.parse('{"path":"/zh/guide/upgrade.html","title":"升级指南","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"升级到 1.3.0","slug":"升级到-1-3-0","link":"#升级到-1-3-0","children":[{"level":3,"title":"破坏更新","slug":"破坏更新","link":"#破坏更新","children":[]}]},{"level":2,"title":"升级到 1.2.0","slug":"升级到-1-2-0","link":"#升级到-1-2-0","children":[]},{"level":2,"title":"升级到 1.1.0","slug":"升级到-1-1-0","link":"#升级到-1-1-0","children":[{"level":3,"title":"破坏更新","slug":"破坏更新-1","link":"#破坏更新-1","children":[]},{"level":3,"title":"功能更新","slug":"功能更新","link":"#功能更新","children":[]}]}],"git":{"updatedTime":1762917199000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":3,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"46e13b58cc511c8f42bf9ed9d09645ce67d0be50","time":1762917199000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: enhance advanced configuration details and update upgrade guide"},{"hash":"5194a59c8d91c22df9d3965d24cfa2820895261e","time":1751669773000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: improve formatting and links"},{"hash":"0145aa0f95944c9e802bae147d180479ce2bd7a8","time":1751669386000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: add upgrade guide"}]},"filePathRelative":"zh/guide/upgrade.md"}')}}]);
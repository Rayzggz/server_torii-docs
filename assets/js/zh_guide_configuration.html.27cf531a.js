"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[208],{3959:(s,n,a)=>{a.r(n),a.d(n,{comp:()=>p,data:()=>t});var e=a(641);const i={},p=(0,a(6262).A)(i,[["render",function(s,n){return(0,e.uX)(),(0,e.CE)("div",null,n[0]||(n[0]=[(0,e.Fv)('<h1 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h1><h2 id="快速开始配置" tabindex="-1"><a class="header-anchor" href="#快速开始配置"><span>快速开始配置</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>基础快速配置主要关心 Server Torii 的运行关键配置项， 主要是为了让你快速上手使用 Server Torii 并且按照默认配置运行起来。 具体使用还是需要参考后面的详细配置。</p></div><ol><li><p>复制 server_torii 下的 config_example 文件夹， 重命名为 config</p></li><li><p>修改 config/torii.yml 文件</p></li></ol><p>我们主要需要关注以下几个配置项：</p><p><code>port</code> 确保不会被占用</p><p><code>web_path</code> 确保这个路径不会被你的网站使用</p><p><code>error_page</code> 正确设置错误页面存放路径</p><p><code>log_path</code> 正确设置日志存放路径</p><p><code>sites</code> 站点配置文件 默认示例配置文静仅包含了 <code>default_site</code> 站点配置 和路径 config/rules/default 下的规则文件 快速配置时，需要删掉 <code>example.com</code> 和 <code>*.example.com</code> 站点配置</p><p>假设我们将 server_torii 放在 <code>/www/server_torii</code> 目录下 config/torii.yml 文件内容如下：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii 监听端口  此端口不需要公开 仅供 Nginx 访问</span></span>\n<span class="line">    <span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Server Torii 访问路径</span></span>\n<span class="line">    <span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># 错误页面存放路径 </span></span>\n<span class="line">    <span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># 日志存放路径</span></span>\n<span class="line">    <span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_feature_control_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Feature-Control&quot;</span></span>\n<span class="line"></span>\n<span class="line">    <span class="token key atrule">sites</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;default_site&quot;</span> <span class="token comment">#这个是默认站点配置 对应没有匹配到其他站点的请求</span></span>\n<span class="line">        <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/default&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>修改 Nginx 配置文件</li></ol><p>ngx_torii 的配置方式与 Nginx 的 auth_request 模块完全一致</p><p>在需要使用 Server Torii 的站点配置文件中添加以下配置</p><p>下面配置中所有的路径 <code>/torii</code> 需要与上面配置的 <code>web_path</code> 一致</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment">#放在你需要保护的块中 例如放在反向代理的 location 块中</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">445</span> = @torii_page</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">torii_auth_request_set</span> <span class="token variable">$torii_action_uri</span> <span class="token variable">$upstream_http_torii_action</span></span><span class="token punctuation">;</span>  </span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 下面这些配置放在 server 块中 用于接收 torii_auth_request 配置的验证请求</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> @torii_page</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker_pages/<span class="token variable">$torii_action_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>重载 Nginx 使配置生效</li></ol>',18)]))}]]),t=JSON.parse('{"path":"/zh/guide/configuration.html","title":"配置","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"快速开始配置","slug":"快速开始配置","link":"#快速开始配置","children":[]}],"git":{"updatedTime":1762913488000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":5,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"f7aaae1da165b349d309caba80e78136d298db91","time":1762913488000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: update configuration documentation and add advanced configuration details"},{"hash":"5194a59c8d91c22df9d3965d24cfa2820895261e","time":1751669773000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: improve formatting and links"},{"hash":"c048890e1f729c2bb40fb069ff30099a264028d6","time":1751498824000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: 1.1.0"},{"hash":"3dff4c5880463399c95e12a5dbafefc6ad33d234","time":1746331539000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: en"},{"hash":"299946ad065640e8de3d4e3db60fb34b451b9e4a","time":1746329088000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: chinese"}]},"filePathRelative":"zh/guide/configuration.md"}')}}]);
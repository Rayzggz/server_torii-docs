"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[71],{211:(s,n,a)=>{a.r(n),a.d(n,{comp:()=>t,data:()=>l});var e=a(641);const i={},t=(0,a(262).A)(i,[["render",function(s,n){return(0,e.uX)(),(0,e.CE)("div",null,n[0]||(n[0]=[(0,e.Fv)('<h1 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h1><h2 id="basic-quick-setup" tabindex="-1"><a class="header-anchor" href="#basic-quick-setup"><span>Basic Quick Setup</span></a></h2><div class="hint-container tip"><p class="hint-container-title">Tip</p><p>The Basic Quick Setup focuses on the critical configuration items for running Server Torii. It’s intended to help you get started quickly with the default configuration. For detailed usage, please refer to the subsequent sections.</p></div><ol><li>Copy and create the config file</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">   <span class="token function">cp</span> <span class="token parameter variable">-r</span> server_torii/config_example server_torii/config</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>Edit config/torii.yml</li></ol><p>Focus on the following key settings:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>\n<span class="line">    <span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>\n<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules&quot;</span> <span class="token comment"># Directory for rule files (this example assumes /www/server_torii as the install dir)</span></span>\n<span class="line">    <span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>\n<span class="line">    <span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Update your Nginx configuration</li></ol><p>The ngx_torii module uses the similar directives as Nginx’s auth_request module.</p><p>In the server block or location where you want to protection, add:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span>  <span class="token comment">#Send auth check to Server Torii</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Receive auth checks from torii_auth_request</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Captcha-Status <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Handle all other Server Torii endpoints (captcha pages, health checks, etc.)</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>Reload Nginx</li></ol><h2 id="more-configuration" tabindex="-1"><a class="header-anchor" href="#more-configuration"><span>More Configuration</span></a></h2><h3 id="config-torii-yml" tabindex="-1"><a class="header-anchor" href="#config-torii-yml"><span>config/torii.yml</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>\n<span class="line"><span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>\n<span class="line"><span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules&quot;</span> <span class="token comment"># Directory for rule files (this example assumes /www/server_torii as the install dir)</span></span>\n<span class="line"><span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>\n<span class="line"><span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>\n<span class="line"><span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span> <span class="token comment"># Node name used for display on the output page, can be used to distinguish nodes in a distributed deployment.</span></span>\n<span class="line"><span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span> <span class="token comment"># Host header, used to determine the domain name of the request.</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>\n<span class="line"><span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span> <span class="token comment"># IP header, used to determine the User IP of the request.</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>\n<span class="line"><span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span> <span class="token comment"># URI header, used to determine the URI of the request.</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>\n<span class="line"><span class="token key atrule">connecting_captcha_status_headers</span><span class="token punctuation">:</span> <span class="token comment"># Turn on or Turn off the CAPTCHA</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Captcha-Status&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="captcha-yml" tabindex="-1"><a class="header-anchor" href="#captcha-yml"><span>CAPTCHA.yml</span></a></h3><h4 id="secret-key" tabindex="-1"><a class="header-anchor" href="#secret-key"><span><code>secret_key</code></span></a></h4><p>A shared key for encrypting/decrypting the clearance cookie. In clustered setups, all nodes must use the same key to validate cookies.</p><h4 id="captcha-validate-time" tabindex="-1"><a class="header-anchor" href="#captcha-validate-time"><span><code>captcha_validate_time</code></span></a></h4><p>Time (in seconds) for which a passed captcha remains valid before re‑challenge.</p><h4 id="captcha-challenge-session-timeout" tabindex="-1"><a class="header-anchor" href="#captcha-challenge-session-timeout"><span><code>captcha_challenge_session_timeout</code></span></a></h4><p>Time (in seconds) allowed to complete the captcha after the challenge page loads.</p><h4 id="hcaptcha-secret" tabindex="-1"><a class="header-anchor" href="#hcaptcha-secret"><span><code>hcaptcha_secret</code></span></a></h4><p>Your hCaptcha secret key for server‑side verification.</p><h3 id="httpflood-yml" tabindex="-1"><a class="header-anchor" href="#httpflood-yml"><span>HTTPFlood.yml</span></a></h3><p>This feature cannot be disabled in current version. To turn it off with minimize the influence, set extremely high limits and very short intervals. (like 1000000/1s )</p><h4 id="httpfloodspeedlimit" tabindex="-1"><a class="header-anchor" href="#httpfloodspeedlimit"><span><code>HTTPFloodSpeedLimit</code></span></a></h4><p><code> - &quot;150/10s&quot;</code> Allows up to 150 requests per IP every 10 seconds (429 on excess).</p><h4 id="httpfloodsameurilimit" tabindex="-1"><a class="header-anchor" href="#httpfloodsameurilimit"><span><code>HTTPFloodSameURILimit</code></span></a></h4><p><code> - &quot;50/10s&quot;</code></p><p>Allows up to 50 requests per IP to the same URI every 10 seconds (429 on excess). Helps mitigate URI‑focused floods.</p><h3 id="ip-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#ip-allowlist-conf"><span>IP_AllowList.conf</span></a></h3><p>One IP (or CIDR) per line Allowlisted addresses bypass all checks.</p><h3 id="ip-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#ip-blocklist-conf"><span>IP_BlockList.conf</span></a></h3><p>One IP (or CIDR) per line Blocklisted addresses are immediately blocked.</p><h3 id="url-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#url-allowlist-conf"><span>URL_AllowList.conf</span></a></h3><p>One URL pattern (regex) per line Allowlisted URIs are immediately blocked.</p><h3 id="url-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#url-blocklist-conf"><span>URL_BlockList.conf</span></a></h3><p>One URL pattern (regex) per line Blocklisted URIs are immediately blocked.</p><h3 id="verifybot-yml" tabindex="-1"><a class="header-anchor" href="#verifybot-yml"><span>VerifyBot.yml</span></a></h3><p>Use User‑Agent and reverse‑DNS to verify legitimate crawlers:</p><p>verify_google_bot # Googlebot</p><p>verify_bing_bot # Bingbot</p><p>verify_baidu_bot # Baidu spider</p><p>verify_yandex_bot # Yandex crawler</p><p>verify_sogou_bot # Sogou spider</p><p>verify_apple_bot # Applebot</p><h3 id="ngx-torii-module-configuration" tabindex="-1"><a class="header-anchor" href="#ngx-torii-module-configuration"><span>ngx_torii Module Configuration</span></a></h3><p>The ngx_torii module uses the similar directives as Nginx’s auth_request module.</p><p>You can reference the document of ngx_http_auth_request_module <code>https://nginx.org/en/docs/http/ngx_http_auth_request_module.html</code></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request uri | <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">Default:</span>   torii_auth_request <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">Context:   http, server, location</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request_set <span class="token variable">$variable</span> value</span><span class="token punctuation">;</span></span>\n<span class="line">Default:   —</span>\n<span class="line">Context:   http, server, location</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example Reverse‑Proxy with Server Torii:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment">#Reverse‑proxy your upstream service</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> </span>\n<span class="line"><span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:3001/</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host localhost</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> REMOTE-HOST <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token variable">$connection_upgrade</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span>   <span class="token comment">#Route through Server Torii</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Receive the auth check</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Captcha-Status <span class="token boolean">on</span></span><span class="token punctuation">;</span> <span class="token comment">#set to off to disable captcha</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Handle Torii’s own endpoints (captcha, health, etc.)</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',55)]))}]]),l=JSON.parse('{"path":"/guide/configuration.html","title":"Configuration","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Basic Quick Setup","slug":"basic-quick-setup","link":"#basic-quick-setup","children":[]},{"level":2,"title":"More Configuration","slug":"more-configuration","link":"#more-configuration","children":[{"level":3,"title":"config/torii.yml","slug":"config-torii-yml","link":"#config-torii-yml","children":[]},{"level":3,"title":"CAPTCHA.yml","slug":"captcha-yml","link":"#captcha-yml","children":[]},{"level":3,"title":"HTTPFlood.yml","slug":"httpflood-yml","link":"#httpflood-yml","children":[]},{"level":3,"title":"IP_AllowList.conf","slug":"ip-allowlist-conf","link":"#ip-allowlist-conf","children":[]},{"level":3,"title":"IP_BlockList.conf","slug":"ip-blocklist-conf","link":"#ip-blocklist-conf","children":[]},{"level":3,"title":"URL_AllowList.conf","slug":"url-allowlist-conf","link":"#url-allowlist-conf","children":[]},{"level":3,"title":"URL_BlockList.conf","slug":"url-blocklist-conf","link":"#url-blocklist-conf","children":[]},{"level":3,"title":"VerifyBot.yml","slug":"verifybot-yml","link":"#verifybot-yml","children":[]},{"level":3,"title":"ngx_torii Module Configuration","slug":"ngx-torii-module-configuration","link":"#ngx-torii-module-configuration","children":[]}]}],"git":{"updatedTime":1746407794000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":1,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"670a69ef292948d85a1bb8dcdaa2df27c7efef67","time":1746407794000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: en configuration.md"}]},"filePathRelative":"guide/configuration.md"}')}}]);
"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[556],{1548:(s,n,a)=>{a.r(n),a.d(n,{comp:()=>i,data:()=>l});var e=a(641);const t={},i=(0,a(6262).A)(t,[["render",function(s,n){const a=(0,e.g2)("RouteLink");return(0,e.uX)(),(0,e.CE)("div",null,[n[3]||(n[3]=(0,e.Fv)('<h1 id="configuration-advanced" tabindex="-1"><a class="header-anchor" href="#configuration-advanced"><span>Configuration Advanced</span></a></h1><h2 id="config-torii-yml" tabindex="-1"><a class="header-anchor" href="#config-torii-yml"><span>config/torii.yml</span></a></h2><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>\n<span class="line"><span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>\n<span class="line"><span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>\n<span class="line"><span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>\n<span class="line"><span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span> <span class="token comment"># Node name used for display on the output page, can be used to distinguish nodes in a distributed deployment.</span></span>\n<span class="line"><span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span> <span class="token comment"># Host header, used to determine the domain name of the request.</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>\n<span class="line"><span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span> <span class="token comment"># IP header, used to determine the User IP of the request.</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>\n<span class="line"><span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span> <span class="token comment"># URI header, used to determine the URI of the request.</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>\n<span class="line"><span class="token key atrule">connecting_feature_control_headers</span><span class="token punctuation">:</span> <span class="token comment"># Feature control header, used to toggle features.</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Feature-Control&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span class="token key atrule">sites</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;default_site&quot;</span> <span class="token comment"># This is the default site configuration, corresponding to requests that do not match any other sites. The rule_path below is the path to the rules file.</span></span>\n<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/default&quot;</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;example.com&quot;</span> <span class="token comment"># This is the configuration for the example.com site. This is an exact match; when matching, priority is given to exact matches, and wildcard matching will only occur if no exact match is found.</span></span>\n<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/example.com&quot;</span></span>\n<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;*.example.com&quot;</span> <span class="token comment"># This is a wildcard configuration. Currently, it only supports using one * wildcard at the beginning. It does not support usage in the middle or at the end. For example, abc.*.com or abc.com.* are not supported.</span></span>\n<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/example.com&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="server-yml" tabindex="-1"><a class="header-anchor" href="#server-yml"><span>Server.yml</span></a></h2><p>Each enabled set to true indicates that the corresponding feature is activated. Other details are explained in the following sections.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">IPAllow</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line"><span class="token key atrule">IPBlock</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line"><span class="token key atrule">URLAllow</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line"><span class="token key atrule">URLBlock</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line"><span class="token key atrule">CAPTCHA</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>\n<span class="line">  <span class="token key atrule">captcha_validate_time</span><span class="token punctuation">:</span> <span class="token number">600</span></span>\n<span class="line">  <span class="token key atrule">captcha_challenge_session_timeout</span><span class="token punctuation">:</span> <span class="token number">120</span></span>\n<span class="line">  <span class="token key atrule">hcaptcha_secret</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span></span>\n<span class="line"><span class="token key atrule">HTTPFlood</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">HTTPFloodSpeedLimit</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;150/10s&quot;</span></span>\n<span class="line">  <span class="token key atrule">HTTPFloodSameURILimit</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;50/10s&quot;</span></span>\n<span class="line"><span class="token key atrule">VerifyBot</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_google_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_bing_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_baidu_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_yandex_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_sogou_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_apple_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line"><span class="token key atrule">ExternalMigration</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>\n<span class="line">  <span class="token key atrule">redirect_url</span><span class="token punctuation">:</span> <span class="token string">&quot;https://example.com/migration&quot;</span></span>\n<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>\n<span class="line">  <span class="token key atrule">session_timeout</span><span class="token punctuation">:</span> <span class="token number">1800</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="captcha" tabindex="-1"><a class="header-anchor" href="#captcha"><span>CAPTCHA：</span></a></h3><p>CAPTCHA settings, used to challenge users</p><h4 id="secret-key" tabindex="-1"><a class="header-anchor" href="#secret-key"><span><code>secret_key</code></span></a></h4><p>A shared key for encrypting/decrypting the clearance cookie. In clustered setups, all nodes must use the same key to validate cookies.</p><h4 id="captcha-validate-time" tabindex="-1"><a class="header-anchor" href="#captcha-validate-time"><span><code>captcha_validate_time</code></span></a></h4><p>Time (in seconds) for which a passed captcha remains valid before re‑challenge.</p><h4 id="captcha-challenge-session-timeout" tabindex="-1"><a class="header-anchor" href="#captcha-challenge-session-timeout"><span><code>captcha_challenge_session_timeout</code></span></a></h4><p>Time (in seconds) allowed to complete the captcha after the challenge page loads.</p><h4 id="hcaptcha-secret" tabindex="-1"><a class="header-anchor" href="#hcaptcha-secret"><span><code>hcaptcha_secret</code></span></a></h4><p>Your hCaptcha secret key for server‑side verification.</p><h3 id="httpflood" tabindex="-1"><a class="header-anchor" href="#httpflood"><span>HTTPFlood：</span></a></h3><p>Speed limit settings for HTTP flood protection.</p><h4 id="httpfloodspeedlimit" tabindex="-1"><a class="header-anchor" href="#httpfloodspeedlimit"><span><code>HTTPFloodSpeedLimit</code></span></a></h4><p><code> - &quot;150/10s&quot;</code> Allows up to 150 requests per IP every 10 seconds (429 on excess).</p><h4 id="httpfloodsameurilimit" tabindex="-1"><a class="header-anchor" href="#httpfloodsameurilimit"><span><code>HTTPFloodSameURILimit</code></span></a></h4><p><code> - &quot;50/10s&quot;</code></p><p>Allows up to 50 requests per IP to the same URI every 10 seconds (429 on excess). Helps mitigate URI‑focused floods.</p><h3 id="verifybot" tabindex="-1"><a class="header-anchor" href="#verifybot"><span>VerifyBot:</span></a></h3><p>Use User‑Agent and reverse‑DNS to verify legitimate crawlers:</p><p>verify_google_bot # Googlebot</p><p>verify_bing_bot # Bingbot</p><p>verify_baidu_bot # Baidu spider</p><p>verify_yandex_bot # Yandex crawler</p><p>verify_sogou_bot # Sogou spider</p><p>verify_apple_bot # Applebot</p><h3 id="externalmigration" tabindex="-1"><a class="header-anchor" href="#externalmigration"><span>ExternalMigration:</span></a></h3><p>If the traffic is too high and the server cannot handle it, this configuration can be used to redirect requests to external mitigation facilities such as Cloudflare or waiting room. After verification/waiting through an external service, requests will return to Server Torii for access.</p><h4 id="redirect-url" tabindex="-1"><a class="header-anchor" href="#redirect-url"><span><code>redirect_url</code></span></a></h4><p>The URL address for redirection. if the user does not have a valid cookie, they will be redirected to this address.</p><h4 id="secret-key-1" tabindex="-1"><a class="header-anchor" href="#secret-key-1"><span><code>secret_key</code></span></a></h4><p>A key used for encrypting and decrypting the redirect cookie. This cookie will be set in the browser after the user has been verified and is mainly used to determine whether the user has passed verification. In distributed deployments, as long as all nodes share the same key, different nodes can validate the cookies.</p><h4 id="session-timeout" tabindex="-1"><a class="header-anchor" href="#session-timeout"><span><code>session_timeout</code></span></a></h4><p>The validity period of the cookie issued after successful verification at external mitigation facilities, measured in seconds.</p>',40)),(0,e.Lk)("p",null,[n[1]||(n[1]=(0,e.eW)("For details on configuring external mitigation services, please refer to ")),(0,e.bF)(a,{to:"/advanced/external_migration.html"},{default:(0,e.k6)((()=>n[0]||(n[0]=[(0,e.eW)("External Migration")]))),_:1}),n[2]||(n[2]=(0,e.eW)("."))]),n[4]||(n[4]=(0,e.Fv)('<hr><h3 id="ip-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#ip-allowlist-conf"><span>IP_AllowList.conf</span></a></h3><p>One IP (or CIDR) per line Allowlisted addresses bypass all checks.</p><hr><h3 id="ip-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#ip-blocklist-conf"><span>IP_BlockList.conf</span></a></h3><p>One IP (or CIDR) per line Blocklisted addresses are immediately blocked.</p><hr><h3 id="url-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#url-allowlist-conf"><span>URL_AllowList.conf</span></a></h3><p>One URL pattern (regex) per line Allowlisted URIs are immediately blocked.</p><hr><h3 id="url-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#url-blocklist-conf"><span>URL_BlockList.conf</span></a></h3><p>One URL pattern (regex) per line Blocklisted URIs are immediately blocked.</p><hr><h2 id="ngx-torii-module-configuration" tabindex="-1"><a class="header-anchor" href="#ngx-torii-module-configuration"><span>ngx_torii Module Configuration</span></a></h2><p>The ngx_torii module uses the similar directives as Nginx’s auth_request module.</p><p>You can reference the document of ngx_http_auth_request_module <code>https://nginx.org/en/docs/http/ngx_http_auth_request_module.html</code></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request uri | <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">Default:</span>   torii_auth_request <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">Context:   http, server, location</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request_set <span class="token variable">$variable</span> value</span><span class="token punctuation">;</span></span>\n<span class="line">Default:   —</span>\n<span class="line">Context:   http, server, location</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example Reverse‑Proxy with Server Torii:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment">#Reverse‑proxy your upstream service</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> </span>\n<span class="line"><span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:3001/</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host localhost</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> REMOTE-HOST <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token variable">$connection_upgrade</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">445</span> = @torii_page</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">torii_auth_request_set</span> <span class="token variable">$torii_action_uri</span> <span class="token variable">$upstream_http_torii_action</span></span><span class="token punctuation">;</span> </span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># The following configurations are placed in the server block to receive auth requests for the torii_auth_request configuration.</span></span>\n<span class="line"><span class="token comment"># proxy_set_header corresponds to the configuration items in torii.yml and is used to pass relevant information.</span></span>\n<span class="line"><span class="token comment"># The usage of the Torii-Feature-Control header will be introduced later. This request header needs to be placed in both /torii/checker and /torii locations, and the values must remain consistent.</span></span>\n<span class="line"><span class="token comment"># You can place this proxy_set_header Torii-Feature-Control &quot;________&quot;; in a separate file and then include it to ensure that the values are consistent across both locations.</span></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Feature-Control <span class="token string">&quot;________&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> @torii_page</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker_pages/<span class="token variable">$torii_action_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>\n<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Feature-Control <span class="token string">&quot;________&quot;</span></span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="usage-of-torii-feature-control-header" tabindex="-1"><a class="header-anchor" href="#usage-of-torii-feature-control-header"><span>Usage of Torii-Feature-Control Header</span></a></h2><p>This header is used to control the feature switches of Server Torii for the current request. The value of this header is a string composed of multiple characters, each representing a feature switch. When processing requests, the Server Torii will decide whether to enable or disable certain features based on the value of this header. This switch control only takes effect for the current request and does not affect settings in the global configuration file.</p><p>The position and meaning of each character are as follows:</p><ul><li>1st character: IPAllow feature</li><li>2nd character: IPBlock feature</li><li>3rd character: URLAllow feature</li><li>4th character: URLBlock feature</li><li>5th character: VerifyBot feature</li><li>6th character: HTTPFlood feature</li><li>7th character: CAPTCHA feature</li><li>8th character: ExternalMigration feature</li></ul><p>Each character can take the following values:</p><ul><li>&#39;1&#39;: Enable the corresponding function, which will override settings in the configuration file.</li><li>&#39;0&#39;: Disable the corresponding function, which will override settings in the configuration file.</li><li>&#39;_&#39;: Inherit settings from the default configuration file. For example:</li><li>&quot;1_0___1_&quot;: Enable IPAllow feature, disable URLAllow feature, enable CAPTCHA feature, other features inherit default configuration.</li></ul><p>You can use this header for flexible configurationYou can use this. For example, you can enable or disable certain features for specific URIs through the location configuration in Nginx. You can also dynamically adjust feature based on backend load, request count, etc., using external scripts such as Shell or Lua.</p>',27))])}]]),l=JSON.parse('{"path":"/advanced/configuration_advanced.html","title":"Configuration Advanced","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"config/torii.yml","slug":"config-torii-yml","link":"#config-torii-yml","children":[]},{"level":2,"title":"Server.yml","slug":"server-yml","link":"#server-yml","children":[{"level":3,"title":"CAPTCHA：","slug":"captcha","link":"#captcha","children":[]},{"level":3,"title":"HTTPFlood：","slug":"httpflood","link":"#httpflood","children":[]},{"level":3,"title":"VerifyBot:","slug":"verifybot","link":"#verifybot","children":[]},{"level":3,"title":"ExternalMigration:","slug":"externalmigration","link":"#externalmigration","children":[]},{"level":3,"title":"IP_AllowList.conf","slug":"ip-allowlist-conf","link":"#ip-allowlist-conf","children":[]},{"level":3,"title":"IP_BlockList.conf","slug":"ip-blocklist-conf","link":"#ip-blocklist-conf","children":[]},{"level":3,"title":"URL_AllowList.conf","slug":"url-allowlist-conf","link":"#url-allowlist-conf","children":[]},{"level":3,"title":"URL_BlockList.conf","slug":"url-blocklist-conf","link":"#url-blocklist-conf","children":[]}]},{"level":2,"title":"ngx_torii Module Configuration","slug":"ngx-torii-module-configuration","link":"#ngx-torii-module-configuration","children":[]},{"level":2,"title":"Usage of Torii-Feature-Control Header","slug":"usage-of-torii-feature-control-header","link":"#usage-of-torii-feature-control-header","children":[]}],"git":{"updatedTime":1764711641000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":5,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"bf67e250f417bbb1e4d21c427923890748ce389f","time":1764711641000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: update section headers in configuration_advanced.md for consistency"},{"hash":"aecaee7137b3460c71600b166e4ea175b2a3cef8","time":1762929880000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: add advanced configuration documentation and update existing settings"},{"hash":"5194a59c8d91c22df9d3965d24cfa2820895261e","time":1751669773000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: improve formatting and links"},{"hash":"c048890e1f729c2bb40fb069ff30099a264028d6","time":1751498824000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: 1.1.0"},{"hash":"670a69ef292948d85a1bb8dcdaa2df27c7efef67","time":1746407794000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: en configuration.md"}]},"filePathRelative":"advanced/configuration_advanced.md"}')}}]);
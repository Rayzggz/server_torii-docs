"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[733],{3358:(n,e,s)=>{s.r(e),s.d(e,{comp:()=>i,data:()=>o});var a=s(641);const t={},i=(0,s(6262).A)(t,[["render",function(n,e){const s=(0,a.g2)("RouteLink");return(0,a.uX)(),(0,a.CE)("div",null,[e[3]||(e[3]=(0,a.Fv)('<h1 id="upgrade-guide" tabindex="-1"><a class="header-anchor" href="#upgrade-guide"><span>Upgrade Guide</span></a></h1><p>Server Torii is currently actively adding new features and improving some existing features. It&#39;s ready to be used to protect your site, but during version updates, there may be some breaking changes.</p><p>Therefore, when updating, please refer to this upgrade guide. The version numbers listed below indicate releases with breaking changes.</p><p>If a version number is skipped, it means that version has no breaking changes or functional update.</p><p>If you are upgrading across multiple versions, please follow the upgrade guides for all intermediate versions sequentially.</p><p>This guide also documents the functional updates for each version to help you quickly configure new features.</p><h3 id="upgrade-to-1-3-0" tabindex="-1"><a class="header-anchor" href="#upgrade-to-1-3-0"><span>Upgrade to 1.3.0</span></a></h3><h3 id="breaking-changes" tabindex="-1"><a class="header-anchor" href="#breaking-changes"><span>Breaking Changes</span></a></h3><h4 id="modify-configuration-file-structure" tabindex="-1"><a class="header-anchor" href="#modify-configuration-file-structure"><span>Modify Configuration File Structure</span></a></h4><p><code>torii.yml</code> has been updated.</p><p>Assuming we place <code>server_torii</code> in the <code>/www/server_torii</code> directory, the content of the <code>config/torii.yml</code> file is as follows:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>\n<span class="line">    <span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>\n<span class="line">    <span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>\n<span class="line">    <span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>\n<span class="line">    <span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>\n<span class="line">    <span class="token key atrule">connecting_feature_control_headers</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Feature-Control&quot;</span></span>\n<span class="line">      <span class="token punctuation">-</span></span>\n<span class="line">    <span class="token key atrule">sites</span><span class="token punctuation">:</span></span>\n<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;default_site&quot;</span> <span class="token comment">#This is the default site configuration corresponding to requests that do not match any other sites.</span></span>\n<span class="line">        <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/default&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Other configuration files from the previous version&#39;s <code>config/rules/</code> have been moved to the site rules directory. They should be placed in either the <code>config/rules/default/</code> directory or other site rules directories, consistent with the <code>rule_path</code> configuration in <code>torii.yml</code>.</p><h4 id="modify-nginx-configuration-file" tabindex="-1"><a class="header-anchor" href="#modify-nginx-configuration-file"><span>Modify Nginx Configuration File</span></a></h4><p>The <code>ngx_torii</code> module has been updated. You need to pull the latest repository and recompile Nginx.</p><p>Similarly, the Nginx configuration file also needs to be updated. Please refer to the configuration guide.</p><h2 id="upgrade-to-1-2-0" tabindex="-1"><a class="header-anchor" href="#upgrade-to-1-2-0"><span>Upgrade to 1.2.0</span></a></h2><p>This version has been withdrawn, please upgrade directly to 1.3.0.</p><h2 id="upgrade-to-1-1-0" tabindex="-1"><a class="header-anchor" href="#upgrade-to-1-1-0"><span>Upgrade to 1.1.0</span></a></h2><h3 id="breaking-changes-1" tabindex="-1"><a class="header-anchor" href="#breaking-changes-1"><span>Breaking Changes</span></a></h3><h4 id="configuration-file" tabindex="-1"><a class="header-anchor" href="#configuration-file"><span>Configuration File</span></a></h4><p>The YAML configuration files <code>CAPTCHA.yml</code>, <code>HTTPFlood.yml</code>, and <code>VerifyBot.yml</code>, previously located in the <code>config/rules</code> path, have been merged into the <code>CAPTCHA</code>, <code>HTTPFlood</code>, and <code>VerifyBot</code> sections within <code>Server.yml</code>.</p><p>You can simply copy the contents of these three files into the corresponding sections of <code>Server.yml</code>. Please be careful with the YAML indentation format.</p><p>The new configuration is as follows:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">CAPTCHA</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>\n<span class="line">  <span class="token key atrule">captcha_validate_time</span><span class="token punctuation">:</span> <span class="token number">600</span></span>\n<span class="line">  <span class="token key atrule">captcha_challenge_session_timeout</span><span class="token punctuation">:</span> <span class="token number">120</span></span>\n<span class="line">  <span class="token key atrule">hcaptcha_secret</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span></span>\n<span class="line"><span class="token key atrule">HTTPFlood</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">HTTPFloodSpeedLimit</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;150/10s&quot;</span></span>\n<span class="line">  <span class="token key atrule">HTTPFloodSameURILimit</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;50/10s&quot;</span></span>\n<span class="line"><span class="token key atrule">VerifyBot</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">verify_google_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_bing_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_baidu_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_yandex_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_sogou_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line">  <span class="token key atrule">verify_apple_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>\n<span class="line"><span class="token key atrule">ExternalMigration</span><span class="token punctuation">:</span></span>\n<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>\n<span class="line">  <span class="token key atrule">redirect_url</span><span class="token punctuation">:</span> <span class="token string">&quot;https://example.com/migration&quot;</span></span>\n<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>\n<span class="line">  <span class="token key atrule">session_timeout</span><span class="token punctuation">:</span> <span class="token number">1800</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="feature-updates" tabindex="-1"><a class="header-anchor" href="#feature-updates"><span>Feature Updates</span></a></h3><h4 id="external-mitigation-service" tabindex="-1"><a class="header-anchor" href="#external-mitigation-service"><span>External Mitigation Service</span></a></h4>',27)),(0,a.Lk)("p",null,[e[1]||(e[1]=(0,a.eW)("Server Torii now supports an external mitigation service. You can configure Server Torii to redirect users to an external service for verification. Please refer to the ")),(0,a.bF)(s,{to:"/advanced/external_migration.html"},{default:(0,a.k6)((()=>e[0]||(e[0]=[(0,a.eW)("External Mitigation Service Configuration")]))),_:1}),e[2]||(e[2]=(0,a.eW)(" for setup instructions."))]),e[4]||(e[4]=(0,a.Lk)("h4",{id:"new-error-pages",tabindex:"-1"},[(0,a.Lk)("a",{class:"header-anchor",href:"#new-error-pages"},[(0,a.Lk)("span",null,"New Error Pages")])],-1)),e[5]||(e[5]=(0,a.Lk)("p",null,[(0,a.eW)("Some errors will now be output via an error page template. You can customize the content of the error page by modifying "),(0,a.Lk)("code",null,"config/error_page/error.html"),(0,a.eW)(".")],-1))])}]]),o=JSON.parse('{"path":"/guide/upgrade.html","title":"Upgrade Guide","lang":"en-US","frontmatter":{},"headers":[{"level":3,"title":"Upgrade to 1.3.0","slug":"upgrade-to-1-3-0","link":"#upgrade-to-1-3-0","children":[]},{"level":3,"title":"Breaking Changes","slug":"breaking-changes","link":"#breaking-changes","children":[]},{"level":2,"title":"Upgrade to 1.2.0","slug":"upgrade-to-1-2-0","link":"#upgrade-to-1-2-0","children":[]},{"level":2,"title":"Upgrade to 1.1.0","slug":"upgrade-to-1-1-0","link":"#upgrade-to-1-1-0","children":[{"level":3,"title":"Breaking Changes","slug":"breaking-changes-1","link":"#breaking-changes-1","children":[]},{"level":3,"title":"Feature Updates","slug":"feature-updates","link":"#feature-updates","children":[]}]}],"git":{"updatedTime":1762929880000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":3,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"aecaee7137b3460c71600b166e4ea175b2a3cef8","time":1762929880000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: add advanced configuration documentation and update existing settings"},{"hash":"5194a59c8d91c22df9d3965d24cfa2820895261e","time":1751669773000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: improve formatting and links"},{"hash":"0145aa0f95944c9e802bae147d180479ce2bd7a8","time":1751669386000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: add upgrade guide"}]},"filePathRelative":"guide/upgrade.md"}')}}]);
"use strict";(self.webpackChunkserver_torii=self.webpackChunkserver_torii||[]).push([[2],{977:(n,e,i)=>{i.r(e),i.d(e,{comp:()=>l,data:()=>t});var s=i(641);const a={},l=(0,i(6262).A)(a,[["render",function(n,e){const i=(0,s.g2)("RouteLink");return(0,s.uX)(),(0,s.CE)("div",null,[e[1]||(e[1]=(0,s.Fv)('<h1 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h1><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Server Torii is currently actively adding new features and improving some existing features. It&#39;s ready to be used to protect your site, but during version updates, there may be some breaking changes. Therefore, Make sure to read the Upgrade Guide when updating.</p></div><p>The installation contain two parts: ngx_torii and server_torii.</p><p>ngx_torii is a Nginx module that serves as a connector for server_torii, forwarding requests from Nginx to server_torii.</p><h2 id="install-server-torii" tabindex="-1"><a class="header-anchor" href="#install-server-torii"><span>Install server_torii</span></a></h2><ol><li>Create a working directory You may choose any directory you prefer:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /www/server_torii</span>\n<span class="line"><span class="token builtin class-name">cd</span> /www/server_torii</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>2.Clone the repository</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">git</span> clone https://github.com/Rayzggz/server_torii.git</span>\n<span class="line"><span class="token builtin class-name">cd</span> server_torii</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Configuration</li></ol><p>Edit the configuration file according to the Configuration Guide.</p>',11)),(0,s.Lk)("p",null,[(0,s.bF)(i,{to:"/guide/configuration.html"},{default:(0,s.k6)((()=>e[0]||(e[0]=[(0,s.eW)("Quick Setup")]))),_:1})]),e[2]||(e[2]=(0,s.Fv)('<ol start="4"><li>Build and install</li></ol><p>The Makefile provides an installation target which:</p><ul><li>Compiles the binary in the current directory</li><li>Places the executable in this directory</li><li>Registers server_torii as a system service</li><li>Starts the service immediately</li><li>Adds it to the system startup sequence</li></ul><p>To compile and install:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">make</span> <span class="token function">install</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If you prefer to run it differently, you can compile and execute it like any standard Go application.</p><h2 id="compiling-and-installing-ngx-torii" tabindex="-1"><a class="header-anchor" href="#compiling-and-installing-ngx-torii"><span>Compiling and Installing ngx_torii</span></a></h2><div class="hint-container tip"><p class="hint-container-title">How to get Nginx compile arguments</p><p>You need to get the compile arguments of Nginx by running <code>nginx -V</code> Example：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"># nginx -V</span>\n<span class="line"></span>\n<span class="line">nginx version: nginx/1.21.4</span>\n<span class="line">built by gcc 13.3.0 (Ubuntu 13.3.0-6ubuntu2~24.04) </span>\n<span class="line">built with OpenSSL 1.1.1w  11 Sep 2023</span>\n<span class="line">TLS SNI support enabled</span>\n<span class="line">configure arguments: --user=www --group=www --prefix=/www/server/nginx --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-openssl=/www/server/nginx/src/openssl --with-pcre=pcre-8.43 --with-http_v2_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-http_auth_request_module --add-module=/www/server/nginx/src/ngx_http_substitutions_filter_module-master --with-ld-opt=-Wl,-E --with-cc-opt=-Wno-error --with-ld-opt=-ljemalloc --with-http_dav_module --add-module=/www/server/nginx/src/nginx-dav-ext-module</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Use the <code>configure arguments:</code> part of the output, which will be referred to as <code>ARG</code> in the following sections.</p></div><p>ngx_torii Repo URL: <code>https://github.com/Rayzggz/ngx_torii</code> This Module is a simple modification of the built-in Nginx module ngx_http_auth_request_module to support server_torii</p><p>Use <code>git clone https://github.com/Rayzggz/ngx_torii</code> to clone the repository.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">$ <span class="token builtin class-name">cd</span> nginx-1.x.x</span>\n<span class="line">$ ./configure ARG --add-module<span class="token operator">=</span>/path/to/ngx_torii</span>\n<span class="line">$ <span class="token function">make</span></span>\n<span class="line">$ <span class="token function">make</span> <span class="token function">install</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="installing-ngx-torii-via-the-aapanel-built-in-nginx-compilation-feature" tabindex="-1"><a class="header-anchor" href="#installing-ngx-torii-via-the-aapanel-built-in-nginx-compilation-feature"><span>Installing ngx_torii via the aaPanel built-in Nginx compilation feature</span></a></h2><div class="hint-container caution"><p class="hint-container-title">Warning</p><p>This method requires uninstalling the current Nginx and reinstalling it, which may affect the services that are currently running.</p><p>If you want to minimize the impact on services and the current Nginx was installed using compilation, you can use the following &quot;Installing ngx_torii via overwriting Nginx of aaPanel&quot; method.</p></div><ol><li>Uninstall the Nginx in App store</li><li>Reinstall Nginx, choose the 「Compiled」</li><li>Click 「Adding custom modules」</li></ol><ul><li>Name： <code>ngx_torii</code></li><li>Description： <code>Server Torii Nginx Module</code></li><li>Parameter： <code>--add-module=/www/server/nginx/src/ngx_torii</code></li><li>Prefix script:</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /www/server/nginx/src</span>\n<span class="line"><span class="token builtin class-name">cd</span> /www/server/nginx/src</span>\n<span class="line"><span class="token function">git</span> clone https://github.com/Rayzggz/ngx_torii</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>Confirm and Install</li></ol><h2 id="installing-ngx-torii-via-overwriting-nginx-of-aapanel" tabindex="-1"><a class="header-anchor" href="#installing-ngx-torii-via-overwriting-nginx-of-aapanel"><span>Installing ngx_torii via overwriting Nginx of aaPanel</span></a></h2><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Using this method requires ensuring that your current Nginx is compiled and installed via the aaPanel. If there are source files in the <code>/www/server/nginx/src</code> folder, it indicates that the current Nginx is installed through compilation.</p></div><div class="hint-container tip"><p class="hint-container-title">How to get Nginx compile arguments</p><p>You need to get the compile arguments of Nginx by running <code>nginx -V</code> Example：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"># nginx -V</span>\n<span class="line"></span>\n<span class="line">nginx version: nginx/1.21.4</span>\n<span class="line">built by gcc 13.3.0 (Ubuntu 13.3.0-6ubuntu2~24.04) </span>\n<span class="line">built with OpenSSL 1.1.1w  11 Sep 2023</span>\n<span class="line">TLS SNI support enabled</span>\n<span class="line">configure arguments: --user=www --group=www --prefix=/www/server/nginx --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-openssl=/www/server/nginx/src/openssl --with-pcre=pcre-8.43 --with-http_v2_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-http_auth_request_module --add-module=/www/server/nginx/src/ngx_http_substitutions_filter_module-master --with-ld-opt=-Wl,-E --with-cc-opt=-Wno-error --with-ld-opt=-ljemalloc --with-http_dav_module --add-module=/www/server/nginx/src/nginx-dav-ext-module</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Use the <code>configure arguments:</code> part of the output, which will be referred to as <code>ARG</code> in the following sections.</p></div><p>Please follow the steps below step-by-step.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># 1. Enter Nginx of aaPanel source directory and download ngx_torii module code.</span></span>\n<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /www/server/nginx/src</span>\n<span class="line"><span class="token builtin class-name">cd</span> /www/server/nginx/src</span>\n<span class="line"><span class="token function">git</span> clone https://github.com/Rayzggz/ngx_torii</span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 2. Some versions of Nginx provided by aaPanel require export LuaJIT environment variables.</span></span>\n<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LUAJIT_LIB</span><span class="token operator">=</span>/usr/local/lib</span>\n<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LUAJIT_INC</span><span class="token operator">=</span>/usr/local/include/luajit-2.1/</span>\n<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/usr/local/lib/:<span class="token variable">$LD_LIBRARY_PATH</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 3. Configure Nginx and add ngx_torii module.</span></span>\n<span class="line"><span class="token comment"># Here ARG should be replaced with compile parameters obtained earlier.</span></span>\n<span class="line">./configure ARG --add-module<span class="token operator">=</span>/www/server/nginx/src/ngx_torii</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 4 . Compile Nginx </span></span>\n<span class="line"><span class="token function">make</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 5 . Stop Nginx service </span></span>\n<span class="line">/etc/init.d/nginx stop</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 6 . Backup current executable file of Nginx </span></span>\n<span class="line"><span class="token function">mv</span> /www/server/nginx/sbin/nginx  /www/server/nginx/sbin/nginx.bak</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 7 . Overwrite the new compiled executable file of Nginx</span></span>\n<span class="line"><span class="token function">cp</span> /www/server/nginx/src/objs/nginx /www/server/nginx/sbin/</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 8 . Start up Nginx service</span></span>\n<span class="line">/etc/init.d/nginx start</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># 9 . Verify if Nginx has correctly loaded ngx_torii module</span></span>\n<span class="line">nginx <span class="token parameter variable">-V</span></span>\n<span class="line">The end ofthe compileparameters should include --add-module<span class="token operator">=</span>/www/server/nginx/src/ngx_torii</span>\n<span class="line"> </span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',22))])}]]),t=JSON.parse('{"path":"/guide/install.html","title":"Installation","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Install server_torii","slug":"install-server-torii","link":"#install-server-torii","children":[]},{"level":2,"title":"Compiling and Installing ngx_torii","slug":"compiling-and-installing-ngx-torii","link":"#compiling-and-installing-ngx-torii","children":[]},{"level":2,"title":"Installing ngx_torii via the aaPanel built-in Nginx compilation feature","slug":"installing-ngx-torii-via-the-aapanel-built-in-nginx-compilation-feature","link":"#installing-ngx-torii-via-the-aapanel-built-in-nginx-compilation-feature","children":[]},{"level":2,"title":"Installing ngx_torii via overwriting Nginx of aaPanel","slug":"installing-ngx-torii-via-overwriting-nginx-of-aapanel","link":"#installing-ngx-torii-via-overwriting-nginx-of-aapanel","children":[]}],"git":{"updatedTime":1763588132000,"contributors":[{"name":"Rayzggz","username":"Rayzggz","email":"37480123+Rayzggz@users.noreply.github.com","commits":6,"url":"https://github.com/Rayzggz"}],"changelog":[{"hash":"847e1732ee395dfa87596a80881d6b29d71a34c1","time":1763588132000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: update configuration and installation documentation and url"},{"hash":"7b9e0131a1fde360de4f7301ec9dc22fbeb0629c","time":1762926183000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: update environment requirements and installation instructions for ngx_torii"},{"hash":"5194a59c8d91c22df9d3965d24cfa2820895261e","time":1751669773000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: improve formatting and links"},{"hash":"bac19908e6c1afc3a19dcf7db6667003606db5d2","time":1746558662000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: Add install warning"},{"hash":"1e3c9056f768a108e300d8d259bbc580c9f73193","time":1746411092000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: add link to config"},{"hash":"18f22f10d2875bd5573e982ce2de0b99c5a71d8e","time":1746406274000,"email":"37480123+Rayzggz@users.noreply.github.com","author":"Roi Feng","message":"docs: en install.md"}]},"filePathRelative":"guide/install.md"}')}}]);
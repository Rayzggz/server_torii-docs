<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Configuration Advanced | Server Torii</title><meta name="description" content="High-performance distributed lightweight DDoS mitigation software">
    <link rel="stylesheet" href="/server_torii-docs/assets/css/styles.d7ec87d7.css">
    <link rel="preload" href="/server_torii-docs/assets/js/runtime~app.abc9c5f4.js" as="script"><link rel="preload" href="/server_torii-docs/assets/css/styles.d7ec87d7.css" as="style"><link rel="preload" href="/server_torii-docs/assets/js/768.b285f39f.js" as="script"><link rel="preload" href="/server_torii-docs/assets/js/app.efe1bc44.js" as="script">
    <link rel="prefetch" href="/server_torii-docs/assets/js/zh_advanced_configuration_advanced.html.2b468dde.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/advanced_configuration_advanced.html.12f5c169.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_install.html.4cba22d0.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_install.html.310f3eec.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_upgrade.html.e4da9d7a.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_configuration.html.a00df986.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_upgrade.html.6ab8e49e.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_configuration.html.27cf531a.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/advanced_external_migration.html.7377d005.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_advanced_external_migration.html.3211c71f.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_prerequisites.html.796a208f.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_prerequisites.html.5770ee5c.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_home.html.832b034b.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_home.html.af10194d.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/guide_faq.html.d7368412.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_guide_faq.html.9ffea939.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/index.html.94ef830c.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_index.html.7801640b.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/development_roadmap.html.afa5ac46.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/zh_development_roadmap.html.8a854220.js" as="script"><link rel="prefetch" href="/server_torii-docs/assets/js/404.html.2614f6c9.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/server_torii-docs/"><img class="vp-site-logo" src="/server_torii-docs/images/shinto_shrine.png" alt="Server Torii"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Server Torii</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/guide/home.html" aria-label="Getting started"><!--[--><!--[--><!--]--><!--]-->Getting started<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/server_torii-docs/advanced/configuration_advanced.html" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/server_torii-docs/zh/advanced/configuration_advanced.html" aria-label="简体中文"><!--[--><!--[--><!--]--><!--]-->简体中文<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Rayzggz/server_torii" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/server_torii-docs/guide/home.html" aria-label="Getting started"><!--[--><!--[--><!--]--><!--]-->Getting started<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">选择语言 / Select Language</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/server_torii-docs/advanced/configuration_advanced.html" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/server_torii-docs/zh/advanced/configuration_advanced.html" aria-label="简体中文"><!--[--><!--[--><!--]--><!--]-->简体中文<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Rayzggz/server_torii" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Guide <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/home.html" aria-label="Introduction"><!--[--><!--[--><!--]--><!--]-->Introduction<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/prerequisites.html" aria-label="Environment Preparation"><!--[--><!--[--><!--]--><!--]-->Environment Preparation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/install.html" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/configuration.html" aria-label="Configuration"><!--[--><!--[--><!--]--><!--]-->Configuration<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/faq.html" aria-label="Frequently Asked Questions"><!--[--><!--[--><!--]--><!--]-->Frequently Asked Questions<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/guide/upgrade.html" aria-label="Upgrade Guide"><!--[--><!--[--><!--]--><!--]-->Upgrade Guide<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Advanced <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/server_torii-docs/advanced/configuration_advanced.html" aria-label="Configuration Advanced"><!--[--><!--[--><!--]--><!--]-->Configuration Advanced<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/advanced/external_migration.html" aria-label="External Mitigation Service Configuration"><!--[--><!--[--><!--]--><!--]-->External Mitigation Service Configuration<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Development <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/server_torii-docs/development/roadmap.html" aria-label="Development Plan"><!--[--><!--[--><!--]--><!--]-->Development Plan<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="configuration-advanced" tabindex="-1"><a class="header-anchor" href="#configuration-advanced"><span>Configuration Advanced</span></a></h1><h2 id="config-torii-yml" tabindex="-1"><a class="header-anchor" href="#config-torii-yml"><span>config/torii.yml</span></a></h2><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">&quot;25555&quot;</span>  <span class="token comment"># Server Torii listening port; not exposed publicly, only Nginx needs access</span></span>
<span class="line"><span class="token key atrule">web_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/torii&quot;</span> <span class="token comment"># Base URL path for Server Torii</span></span>
<span class="line"><span class="token key atrule">error_page</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/error_page&quot;</span> <span class="token comment"># Directory for custom error pages</span></span>
<span class="line"><span class="token key atrule">log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/log/&quot;</span> <span class="token comment"># Directory for storing logs</span></span>
<span class="line"><span class="token key atrule">node_name</span><span class="token punctuation">:</span> <span class="token string">&quot;Server Torii&quot;</span> <span class="token comment"># Node name used for display on the output page, can be used to distinguish nodes in a distributed deployment.</span></span>
<span class="line"><span class="token key atrule">connecting_host_headers</span><span class="token punctuation">:</span> <span class="token comment"># Host header, used to determine the domain name of the request.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-Host&quot;</span></span>
<span class="line"><span class="token key atrule">connecting_ip_headers</span><span class="token punctuation">:</span> <span class="token comment"># IP header, used to determine the User IP of the request.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Real-IP&quot;</span></span>
<span class="line"><span class="token key atrule">connecting_uri_headers</span><span class="token punctuation">:</span> <span class="token comment"># URI header, used to determine the URI of the request.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Original-URI&quot;</span></span>
<span class="line"><span class="token key atrule">connecting_feature_control_headers</span><span class="token punctuation">:</span> <span class="token comment"># Feature control header, used to toggle features.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;Torii-Feature-Control&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">sites</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;default_site&quot;</span> <span class="token comment"># This is the default site configuration, corresponding to requests that do not match any other sites. The rule_path below is the path to the rules file.</span></span>
<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/default&quot;</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;example.com&quot;</span> <span class="token comment"># This is the configuration for the example.com site. This is an exact match; when matching, priority is given to exact matches, and wildcard matching will only occur if no exact match is found.</span></span>
<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/example.com&quot;</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;*.example.com&quot;</span> <span class="token comment"># This is a wildcard configuration. Currently, it only supports using one * wildcard at the beginning. It does not support usage in the middle or at the end. For example, abc.*.com or abc.com.* are not supported.</span></span>
<span class="line">    <span class="token key atrule">rule_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/www/server_torii/config/rules/example.com&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="server-yml" tabindex="-1"><a class="header-anchor" href="#server-yml"><span>Server.yml</span></a></h2><p>Each enabled set to true indicates that the corresponding feature is activated. Other details are explained in the following sections.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">IPAllow</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">IPBlock</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">URLAllow</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">URLBlock</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">CAPTCHA</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>
<span class="line">  <span class="token key atrule">captcha_validate_time</span><span class="token punctuation">:</span> <span class="token number">600</span></span>
<span class="line">  <span class="token key atrule">captcha_challenge_session_timeout</span><span class="token punctuation">:</span> <span class="token number">120</span></span>
<span class="line">  <span class="token key atrule">hcaptcha_secret</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span></span>
<span class="line"><span class="token key atrule">HTTPFlood</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">HTTPFloodSpeedLimit</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;150/10s&quot;</span></span>
<span class="line">  <span class="token key atrule">HTTPFloodSameURILimit</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;50/10s&quot;</span></span>
<span class="line"><span class="token key atrule">VerifyBot</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">verify_google_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">verify_bing_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">verify_baidu_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">verify_yandex_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">verify_sogou_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">verify_apple_bot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">ExternalMigration</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">redirect_url</span><span class="token punctuation">:</span> <span class="token string">&quot;https://example.com/migration&quot;</span></span>
<span class="line">  <span class="token key atrule">secret_key</span><span class="token punctuation">:</span> <span class="token string">&quot;0378b0f84c4310279918d71a5647ba5d&quot;</span></span>
<span class="line">  <span class="token key atrule">session_timeout</span><span class="token punctuation">:</span> <span class="token number">1800</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="captcha" tabindex="-1"><a class="header-anchor" href="#captcha"><span>CAPTCHA：</span></a></h3><p>CAPTCHA settings, used to challenge users This feature currently does not support being enabled simultaneously with ExternalMigration.</p><h4 id="secret-key" tabindex="-1"><a class="header-anchor" href="#secret-key"><span><code>secret_key</code></span></a></h4><p>A shared key for encrypting/decrypting the clearance cookie. In clustered setups, all nodes must use the same key to validate cookies.</p><h4 id="captcha-validate-time" tabindex="-1"><a class="header-anchor" href="#captcha-validate-time"><span><code>captcha_validate_time</code></span></a></h4><p>Time (in seconds) for which a passed captcha remains valid before re‑challenge.</p><h4 id="captcha-challenge-session-timeout" tabindex="-1"><a class="header-anchor" href="#captcha-challenge-session-timeout"><span><code>captcha_challenge_session_timeout</code></span></a></h4><p>Time (in seconds) allowed to complete the captcha after the challenge page loads.</p><h4 id="hcaptcha-secret" tabindex="-1"><a class="header-anchor" href="#hcaptcha-secret"><span><code>hcaptcha_secret</code></span></a></h4><p>Your hCaptcha secret key for server‑side verification.</p><p>Additionally, you need to integrate the hcaptcha verification widget on the HTML page. Please modify the <code>config/error_page/CAPTCHA.html</code> file and add your hcaptcha site key. For more details, refer to <a href="https://docs.hcaptcha.com/#add-the-hcaptcha-widget-to-your-webpage" target="_blank" rel="noopener noreferrer">hCaptcha Official Documentation</a>.</p><h3 id="httpflood" tabindex="-1"><a class="header-anchor" href="#httpflood"><span>HTTPFlood：</span></a></h3><p>Speed limit settings for HTTP flood protection.</p><h4 id="httpfloodspeedlimit" tabindex="-1"><a class="header-anchor" href="#httpfloodspeedlimit"><span><code>HTTPFloodSpeedLimit</code></span></a></h4><p><code> - &quot;150/10s&quot;</code> Allows up to 150 requests per IP every 10 seconds (429 on excess).</p><h4 id="httpfloodsameurilimit" tabindex="-1"><a class="header-anchor" href="#httpfloodsameurilimit"><span><code>HTTPFloodSameURILimit</code></span></a></h4><p><code> - &quot;50/10s&quot;</code></p><p>Allows up to 50 requests per IP to the same URI every 10 seconds (429 on excess). Helps mitigate URI‑focused floods.</p><h3 id="verifybot" tabindex="-1"><a class="header-anchor" href="#verifybot"><span>VerifyBot:</span></a></h3><p>Use User‑Agent and reverse‑DNS to verify legitimate crawlers Only requests from the following search engine crawlers with a UA declaration will be validated, normal user requests will not undergo validation. For successfully validated crawler requests, they will be allowed through directly without any additional checks such as CAPTCHA or HTTPFlood, to ensure the efficiency of crawling. For failed validation of crawler requests, a 403 Forbidden access response will be returned directly.</p><p>verify_google_bot # Googlebot</p><p>verify_bing_bot # Bingbot</p><p>verify_baidu_bot # Baidu spider</p><p>verify_yandex_bot # Yandex crawler</p><p>verify_sogou_bot # Sogou spider</p><p>verify_apple_bot # Applebot</p><h3 id="externalmigration" tabindex="-1"><a class="header-anchor" href="#externalmigration"><span>ExternalMigration:</span></a></h3><p>If the traffic is too high and the server cannot handle it, this configuration can be used to redirect requests to external mitigation facilities such as Cloudflare or waiting room. After verification/waiting through an external service, requests will return to Server Torii for access. This feature currently does not support being enabled simultaneously with CAPTCHA.</p><h4 id="redirect-url" tabindex="-1"><a class="header-anchor" href="#redirect-url"><span><code>redirect_url</code></span></a></h4><p>The URL address for redirection. if the user does not have a valid cookie, they will be redirected to this address.</p><h4 id="secret-key-1" tabindex="-1"><a class="header-anchor" href="#secret-key-1"><span><code>secret_key</code></span></a></h4><p>A key used for encrypting and decrypting the redirect cookie. This cookie will be set in the browser after the user has been verified and is mainly used to determine whether the user has passed verification. In distributed deployments, as long as all nodes share the same key, different nodes can validate the cookies.</p><h4 id="session-timeout" tabindex="-1"><a class="header-anchor" href="#session-timeout"><span><code>session_timeout</code></span></a></h4><p>The validity period of the cookie issued after successful verification at external mitigation facilities, measured in seconds.</p><p>For details on configuring external mitigation services, please refer to <a class="route-link" href="/server_torii-docs/advanced/external_migration.html">External Migration</a>.</p><hr><h3 id="ip-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#ip-allowlist-conf"><span>IP_AllowList.conf</span></a></h3><p>One IP (or CIDR) per line Allowlisted addresses bypass all checks.</p><hr><h3 id="ip-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#ip-blocklist-conf"><span>IP_BlockList.conf</span></a></h3><p>One IP (or CIDR) per line Blocklisted addresses are immediately blocked and return 403 Forbidden.</p><hr><h3 id="url-allowlist-conf" tabindex="-1"><a class="header-anchor" href="#url-allowlist-conf"><span>URL_AllowList.conf</span></a></h3><p>One URL pattern (regex) per line Allowlisted URIs bypass all checks.</p><hr><h3 id="url-blocklist-conf" tabindex="-1"><a class="header-anchor" href="#url-blocklist-conf"><span>URL_BlockList.conf</span></a></h3><p>One URL pattern (regex) per line Blocklisted URIs are immediately blocked and return 403 Forbidden.</p><hr><h2 id="ngx-torii-module-configuration" tabindex="-1"><a class="header-anchor" href="#ngx-torii-module-configuration"><span>ngx_torii Module Configuration</span></a></h2><p>The ngx_torii module uses the similar directives as Nginx’s auth_request module.</p><p>You can reference the document of ngx_http_auth_request_module <code>https://nginx.org/en/docs/http/ngx_http_auth_request_module.html</code></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request uri | <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">Default:</span>   torii_auth_request <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">Context:   http, server, location</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">Syntax:</span>    torii_auth_request_set <span class="token variable">$variable</span> value</span><span class="token punctuation">;</span></span>
<span class="line">Default:   —</span>
<span class="line">Context:   http, server, location</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example Reverse‑Proxy with Server Torii:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment">#Reverse‑proxy your upstream service</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> </span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:3001/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host localhost</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> REMOTE-HOST <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token variable">$connection_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">torii_auth_request</span> /torii/checker</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">445</span> = @torii_page</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">torii_auth_request_set</span> <span class="token variable">$torii_action_uri</span> <span class="token variable">$upstream_http_torii_action</span></span><span class="token punctuation">;</span> </span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># The following configurations are placed in the server block to receive auth requests for the torii_auth_request configuration.</span></span>
<span class="line"><span class="token comment"># proxy_set_header corresponds to the configuration items in torii.yml and is used to pass relevant information.</span></span>
<span class="line"><span class="token comment"># The usage of the Torii-Feature-Control header will be introduced later. This request header needs to be placed in both /torii/checker and /torii locations, and the values must remain consistent.</span></span>
<span class="line"><span class="token comment"># You can place this proxy_set_header Torii-Feature-Control &quot;________&quot;; in a separate file and then include it to ensure that the values are consistent across both locations.</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii/checker</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Feature-Control <span class="token string">&quot;________&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> @torii_page</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555/torii/checker_pages/<span class="token variable">$torii_action_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass_request_body</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Content-Length <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /torii</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:25555</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Original-URI <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Real-Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_intercept_errors</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Torii-Feature-Control <span class="token string">&quot;________&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="usage-of-torii-feature-control-header" tabindex="-1"><a class="header-anchor" href="#usage-of-torii-feature-control-header"><span>Usage of Torii-Feature-Control Header</span></a></h2><p>This header is used to control the feature switches of Server Torii for the current request. The value of this header is a string composed of multiple characters, each representing a feature switch. When processing requests, the Server Torii will decide whether to enable or disable certain features based on the value of this header. Please ensure that the other configurations for the corresponding features are correctly set in the <code>Server.yml</code> configuration. This switch control only takes effect for the current request and does not affect settings in the global configuration file.</p><p>The position and meaning of each character are as follows:</p><ul><li>1st character: IPAllow feature</li><li>2nd character: IPBlock feature</li><li>3rd character: URLAllow feature</li><li>4th character: URLBlock feature</li><li>5th character: VerifyBot feature</li><li>6th character: HTTPFlood feature</li><li>7th character: CAPTCHA feature</li><li>8th character: ExternalMigration feature</li></ul><p>Each character can take the following values:</p><ul><li>&#39;1&#39;: Enable the corresponding function, which will override settings in the configuration file.</li><li>&#39;0&#39;: Disable the corresponding function, which will override settings in the configuration file.</li><li>&#39;_&#39;: Inherit settings from the default configuration file. For example:</li><li>&quot;1_0___1_&quot;: Enable IPAllow feature, disable URLAllow feature, enable CAPTCHA feature, other features inherit default configuration.</li></ul><p>Taking the switch for CAPTCHA as an example, in this case, you can set the CAPTCHA feature to be off in the configuration file, but by using this request header, you can turn on the CAPTCHA feature. Thus, without adding this request header, the CAPTCHA feature is off. However, after adding this request header, the CAPTCHA feature is turned on, achieving the effect of enabling functionality on demand.</p><p>You can use this header for flexible configurationYou can use this. For example, you can enable or disable certain features for specific URIs through the location configuration in Nginx. You can also dynamically adjust feature based on backend load, request count, etc., using external scripts such as Shell or Lua.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/Rayzggz/server_torii/edit/main/advanced/configuration_advanced.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated:: </span><time class="meta-item-info" datetime="2025-12-23T04:06:29.000Z" data-allow-mismatch>12/23/25, 4:06 AM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 37480123+Rayzggz@users.noreply.github.com">Rayzggz</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><!----><a class="route-link auto-link next" href="/server_torii-docs/advanced/external_migration.html" aria-label="External Mitigation Service Configuration"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">External Mitigation Service Configuration</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script src="/server_torii-docs/assets/js/runtime~app.abc9c5f4.js" defer></script><script src="/server_torii-docs/assets/js/768.b285f39f.js" defer></script><script src="/server_torii-docs/assets/js/app.efe1bc44.js" defer></script>
  </body>
</html>
